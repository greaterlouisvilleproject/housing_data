<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Greater Louisville Project" />

<meta name="date" content="2020-12-08" />

<title>Housing Instability in Louisville</title>

<script src="index_files/header-attrs-2.7/header-attrs.js"></script>
<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Housing Instability in Louisville</h1>
<h4 class="author">Greater Louisville Project</h4>
<h4 class="date">2020-12-08</h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This recreates the Urban Institute’s <a href="https://www.urban.org/features/where-prioritize-emergency-rental-assistance-keep-renters-their-homes">Emergency Rental Assistance Priority Index</a> for Louisville. The original index compares Louisville to the rest of Kentucky. At Greater Louisville Project, we think the more appropriate comparison is to our other peer cities. While the maps below show Louisville, the index values are based on a comparison to all census tracts in the core counties of our peer cities.</p>
<p>Greater Louisville Project has also aggregated the data up to the metro council district level. That data is available in both maps and tables.</p>
<p>In addition to the indexes, the indicators that make up the indexes are also mapped below. Navigation is based on tabs, so clicking on the small blue titles brings up the map related to each title.</p>
<div id="methods-and-definitions" class="section level2">
<h2>Methods and Definitions</h2>
<p>To produce an index with multiple indicators on different scales we used z-scores, which are a measure of how far away from average an observation is. For example, if looking at unemployment, we start with the unemployment rate in all tracts and the score for an individual tract is the number of standard deviations it is away from the average tract.</p>
<p>Data is from the Urban Institute’s <a href="https://www.urban.org/features/where-prioritize-emergency-rental-assistance-keep-renters-their-homes">Emergency Rental Assistance Priority Index</a> and in most cases is tract level census data from 2018. The low income jobs lost to Covid is an <a href="https://www.urban.org/features/where-low-income-jobs-are-being-lost-covid-19">Urban Institute constructed indicator</a>. Complete details on the indicators can be found in the <a href="https://www.urban.org/sites/default/files/2020/08/24/where_to_prioritize_emergency_rental_assistance_to_keep_renters_in_their_homes_technical_appendix.pdf">technical appendix</a>, but they are summarized here for convenience.</p>
<div id="housing-instability-index" class="section level3">
<h3>Housing Instability Index</h3>
<ul>
<li>Poverty: Under the poverty line in the last 12 months</li>
<li>Percent Renting: The percent of households in the area who rent</li>
<li>Cost Burdened: Households making less than 35,000 and paying more than 50% of their income in rent</li>
<li>Overcrowding: Households renting and with more than 1.5 people per room.</li>
<li>Unemployed: In the labor force but not currently employed.</li>
</ul>
</div>
<div id="covid-index" class="section level3">
<h3>Covid Index</h3>
<ul>
<li>Health Insurance: Based on the noninstitutionalized population ages 19-64.</li>
<li>Low Income Job Loss from Covid: Estimated jobs lost to Covid based on previous <a href="https://www.urban.org/features/where-low-income-jobs-are-being-lost-covid-19">Urban Institute Study</a></li>
</ul>
</div>
<div id="equity-index" class="section level3">
<h3>Equity Index</h3>
<ul>
<li>Percent Persons of Color: Percent of people in the area who identify as persons of color</li>
<li>Extremely Low Income: Renter occupied household making less than 30 percent of area median income</li>
<li>Public Assistance: Percent receiving some form of public assistance like SNAP or TANF</li>
<li>Foreign Born: Percent born outside the U.S.</li>
</ul>
<pre class="r"><code>library(glpdata)
library(glptools)

save(home_loan_county, home_loan_tract,
     HPI_county, HPI_zip,
     map_zip, 
     clean_acs_micro,
     file = &quot;glptools_exports.RData&quot;)</code></pre>
<pre class="r"><code>library(tidyverse)
library(rgdal)
library(sf)
library(viridis)
library(magrittr)

load(&quot;glptools_exports.RData&quot;)

df &lt;- read_csv(&quot;housing_index_raw.csv&quot;)

# Filter to just peers
df_peer &lt;- df %&gt;% 
  filter(county_fips %in% c(&quot;1073&quot;, &quot;18097&quot;, &quot;21111&quot;, &quot;26081&quot;, &quot;29095&quot;, &quot;29189&quot;,
                            &quot;29510&quot;, &quot;31055&quot;, &quot;37081&quot;, &quot;37119&quot;, &quot;39049&quot;, &quot;39061&quot;,
                            &quot;40109&quot;, &quot;40143&quot;, &quot;45045&quot;, &quot;47037&quot;, &quot;47093&quot;, &quot;47157&quot;)) %&gt;%
  select(-contains(&quot;z_score&quot;), -contains(&quot;index&quot;)) #drop index and z_score terms so we can recreate them

# Make z scores
make_z &lt;- function(x){
  x &lt;- (x - mean(x)) / sd(x)
}

df_z &lt;- df_peer %&gt;%
  mutate(across(where(is.numeric), make_z, .names = &quot;z_{.col}&quot;))

df_index &lt;- df_z %&gt;%
  mutate(
    housing_instability_index = z_perc_poverty_12mnth * .2 + z_perc_renters * .2 + z_perc_cost_burdened_under_35k * .2 + z_perc_overcrowding_renter_1.50_or_more * .2 + z_perc_unemployed_laborforce * .2,
    covid_index = z_perc_no_hinsure * .5 + z_perc_low_income_jobs_lost * .5,
    equity_index = z_perc_person_of_color * .5 + z_perc_30hamfi * .167 + z_perc_public_assistance * .167 + z_perc_foreign_born * .167,
    overall_index = housing_instability_index * .5 + covid_index * .1 + equity_index * .4
  )</code></pre>
</div>
</div>
</div>
<div id="rental-insecurity-index" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Rental Insecurity Index</h1>
<pre class="r"><code>jfco_shp &lt;- readOGR(&quot;JC Tracts&quot;, layer = &quot;JC Tracts&quot;,
                     GDAL1_integer64_policy = TRUE, verbose = FALSE)

jfco_sf &lt;- st_as_sf(jfco_shp) %&gt;%
  mutate(GEOID = str_sub(GEO_ID, start = -11))

jfco_index &lt;- df_index %&gt;% 
  filter(county_fips == &quot;21111&quot;) 

# Urban institute includes a greyed out flag for tracts without enough data
# It&#39;s easier to set the values to NA because the graphing framework has the ability to easily assign NA a different color
jfco_index &lt;- jfco_index %&gt;%
  mutate(across(where(is.numeric), ~if_else(jfco_index$grayed_out == 1, NA_real_, .)))
         
jfco_sf &lt;- full_join(jfco_sf, jfco_index, by = &quot;GEOID&quot;)

# Transform the percents
mult100 &lt;- function(x){
  x &lt;- x * 100
}

jfco_sf &lt;- jfco_sf %&gt;%
  mutate(across(starts_with(&quot;perc_&quot;), mult100))

make_map &lt;- function(indicator, title = &quot;&quot;, legend = &quot;&quot;, caption = &quot;&quot;, no_legend = FALSE, vir_dir = 1){
  plt &lt;- ggplot(jfco_sf) + 
  geom_sf(aes(fill={{ indicator }} )) +
  # scale_fill_gradient(low = &quot;#323844&quot;, high = &quot;#d63631&quot;, name = &quot;Percent&quot;) +
  scale_fill_viridis(na.value = &quot;grey&quot;, name = legend, direction = vir_dir) +
  theme_bw(base_size = 22) +
  theme(plot.caption = element_text(lineheight = .5)) +
  theme(text = element_text(family = &quot;Montserrat&quot;),
        panel.grid = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.border = element_blank()) +
  labs(title = title,
       caption = caption)
  
  if (no_legend == TRUE){
    plt &lt;- plt + theme(legend.position = &quot;none&quot;)
  }
  
  plt &lt;- plt +
    theme(
      panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
      plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
      legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
      legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
      legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))
  
  return(plt)
}

make_map(overall_index, title = &quot;Rental Insecurity Index&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher rental insecurity. \n This is the Urban Institute&#39;s Emergency Rental Assistance Priority Index modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/rental_insecurity_index-1.png" width="672" /></p>
<p>You can flip through the tabs below to see each of the three subindexes that make up the overall rental index.</p>
<div id="housing-instability-subindex" class="section level2">
<h2>Housing Instability Subindex</h2>
<ul>
<li>Share of people living in poverty</li>
<li>Share of renter-occupied housing units</li>
<li>Share of severely cost-burdened low-income renters</li>
<li>Share of severely overcrowded households</li>
<li>Share of unemployed people</li>
</ul>
<pre class="r"><code>make_map(housing_instability_index, title = &quot;Housing Instability Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher housing instability. \n This is the Urban Institute&#39;s Housing Instability subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/housing_instability_subindex-1.png" width="672" /></p>
</div>
<div id="covid-19-impact-subindex" class="section level2">
<h2>Covid 19 Impact Subindex</h2>
<ul>
<li>Share of adults without health insurance</li>
<li>Share of low-income jobs lost to Covid-19</li>
</ul>
<pre class="r"><code>make_map(covid_index, title = &quot;Covid Instability Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher covid instability. \n This is the Urban Institute&#39;s Covid Instability subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/covid_19_impact_subindex-1.png" width="672" /></p>
</div>
<div id="equity-subindex" class="section level2">
<h2>Equity Subindex</h2>
<ul>
<li>Share of people of color</li>
<li>Share of extremely low-income renter households</li>
<li>Share of households receiving public assistance</li>
<li>Share of people born outside the United States</li>
</ul>
<pre class="r"><code>make_map(equity_index, title = &quot;Equity Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher prioritization based on equity. \n This is the Urban Institute&#39;s Equity subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/equity_subindex-1.png" width="672" /></p>
</div>
</div>
<div id="housing-instability-indicators" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Housing Instability Indicators</h1>
<div id="poverty" class="section level2">
<h2>Poverty</h2>
<pre class="r"><code>make_map(perc_poverty_12mnth, title = &quot;Poverty&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of each census tract that is in poverty. \n Data from Urban Institute.&quot;)</code></pre>
<p><img src="index_files/figure-html/poverty-1.png" width="672" /></p>
</div>
<div id="percent-renting" class="section level2">
<h2>Percent Renting</h2>
<pre class="r"><code>make_map(perc_renters, title = &quot;Percent of Renter Occupied Housing Units&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of each tract that rents. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/renting-1.png" width="672" /></p>
</div>
<div id="cost-burdened-housholds" class="section level2">
<h2>Cost-burdened housholds</h2>
<pre class="r"><code>make_map(perc_cost_burdened_under_35k, title = &quot;Costburdened Households making under 35k&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of households making less than 35,000 and paying more than 50% of their income in rent. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/cost_burdened-1.png" width="672" /></p>
</div>
<div id="overcrowding" class="section level2">
<h2>Overcrowding</h2>
<pre class="r"><code>make_map(perc_overcrowding_renter_1.50_or_more, title = &quot;Overcrowding in Rental Housing&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of households renting and with more than 1.5 people per room. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/overcrowding-1.png" width="672" /></p>
</div>
<div id="unemployed" class="section level2">
<h2>Unemployed</h2>
<pre class="r"><code>make_map(perc_unemployed_laborforce, title = &quot;Unemployment&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of people unemployed but still in the labor force (actively seeking work). \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/unemployment-1.png" width="672" /></p>
</div>
</div>
<div id="covid-indicators" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Covid Indicators</h1>
<div id="no-health-insurance" class="section level2">
<h2>No Health Insurance</h2>
<pre class="r"><code>make_map(perc_no_hinsure, title = &quot;No Health Insurance&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent without health insurance. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/no_health_insurance-1.png" width="672" /></p>
</div>
<div id="low-income-jobs-lost-to-covid" class="section level2">
<h2>Low Income Jobs Lost to Covid</h2>
<pre class="r"><code>make_map(perc_low_income_jobs_lost, title = &quot;Low Income Jobs Lost to Covid&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Estimate from the Urban Institute based on job categories in the each tract. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/low_income_job_loss-1.png" width="672" /></p>
</div>
</div>
<div id="equity-index-1" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Equity Index</h1>
<div id="percent-poc" class="section level2">
<h2>Percent PoC</h2>
<pre class="r"><code>make_map(perc_person_of_color, title = &quot;Percent Persons of Color&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of persons in the area who identify as persons of color. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/people_of_color-1.png" width="672" /></p>
</div>
<div id="extremely-low-income" class="section level2">
<h2>Extremely Low Income</h2>
<pre class="r"><code>make_map(perc_30hamfi, title = &quot;Extremely Low Income&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Renter occupied household making less than 30 percent of area median income. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/extremely_low_income-1.png" width="672" /></p>
</div>
<div id="public-assistance" class="section level2">
<h2>Public Assistance</h2>
<pre class="r"><code>make_map(perc_public_assistance, title = &quot;Recieving Public Assistance&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent receiving some form of public assistance like SNAP or TANF. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/public_assistance-1.png" width="672" /></p>
</div>
<div id="foreign-born" class="section level2">
<h2>Foreign Born</h2>
<pre class="r"><code>make_map(perc_foreign_born, title = &quot;Foreign Born&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent born outside the U.S. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/foreign_born-1.png" width="672" /></p>
</div>
</div>
<div id="peer-city-data" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Peer City Data</h1>
<p>Peer city data is available for the housing stability subindex.</p>
<pre class="r"><code># Ranking graph function
ranking &lt;- function(df, var, plot_title = &quot;&quot;,
                    year = NULL, sex = &quot;total&quot;, race = &quot;total&quot;,
                    order = &quot;Descending&quot;,
                    y_title = &quot;Percent&quot;, caption_text = &quot;&quot;, subtitle_text = &quot;&quot;,
                    bar_label = TRUE, sigfig = 3, accuracy = 0.1,
                    label_function, alternate_text = NULL,
                    ranking_colors = TRUE, text_size){
  # Copy variable var to a new column for use with the &#39;$&#39; operator
  var &lt;- dplyr:::tbl_at_vars(df, vars(!!enquo(var)))
  df$var &lt;- df[[var]]
  # Filter to sex, race, and year
  if (&quot;sex&quot; %in% names(df)) df &lt;- df[df$sex == sex,]
  if (&quot;race&quot; %in% names(df)) df &lt;- df[df$race == race,]
  if(&quot;year&quot; %in% names(df)) {
    if (is.null(year)) year &lt;- max(years_in_df(df, var))
    df &lt;- df[df$year %in% year,]
    if (length(year) &gt; 1) {
      df %&lt;&gt;%
        group_by_at(df %cols_in% c(&quot;MSA&quot;, &quot;FIPS&quot;)) %&gt;%
        summarise(var = mean(var, na.rm = TRUE)) %&gt;%
        ungroup()
    }
  }
  # Add peer data if not already present
  # if (df_type(df) %in% c(&quot;FIPS&quot;, &quot;MSA&quot;) &amp; &quot;current&quot; %not_in% names(df)) df %&lt;&gt;% pull_peers(add_info = T)
  
  # Sort according to order parameter
  if (order %in% c(&quot;descending&quot;, &quot;Descending&quot;)) df %&lt;&gt;% arrange(desc(var))
  if (order %in% c(&quot;ascending&quot;, &quot;Ascending&quot;))   df %&lt;&gt;% arrange(var)
  df %&lt;&gt;% filter(!is.na(var))
  # Create numbered city labels for left side of graph
  df %&lt;&gt;%
    mutate(
      rank = row_number(),
      names = paste0(rank, &quot;. &quot;, city))
  # Set bar colors
  if (ranking_colors) {
    # color_values &lt;- c(&quot;#96ca4f&quot;, &quot;#ffd600&quot;, &quot;#db2834&quot;)
    # color_names &lt;- c(&quot;green&quot;, &quot;yellow&quot;, &quot;red&quot;)
    # if (order %in% c(&quot;descending&quot;, &quot;Descending&quot;)) {color_names  = rev(color_names)}
    # 
    # breaks &lt;- classInt::classIntervals(na.omit(df$var), 3, style = &quot;jenks&quot;)
    # df$color &lt;- NA
    # df$color[df$var &lt;= breaks$brks[2]] &lt;- color_names[1]
    # df$color[df$var &gt; breaks$brks[2] &amp; df$var &lt;= breaks$brks[3]] &lt;- color_names[2]
    # df$color[df$var &gt; breaks$brks[3]] &lt;- color_names[3]
    
    color_values &lt;- c(&quot;#d63631&quot;, &quot;#323844&quot;)
    color_names &lt;- c(&quot;gray&quot;, &quot;red&quot;)
    
    df$color &lt;- &quot;red&quot;
    df$color[df$city == &quot;Louisville&quot;] &lt;- &quot;gray&quot;
  } else {
    df$color &lt;- &quot;blue&quot;
    color_values &lt;- &quot;#f58021&quot;
    color_names &lt;- &quot;blue&quot;
  }
  if (order %in% c(&quot;descending&quot;, &quot;Descending&quot;)) color_values = rev(color_values)
  # Create numeric labels
  # Create numeric labels
  if (!missing(label_function)) {
    label_text &lt;- df$var %&gt;% signif(sigfig) %&gt;% label_function()
  } else if (y_title == &quot;Dollars&quot;) {
    if(mean(df$var, na.rm = TRUE) &gt; 10000) {
      label_text &lt;- df$var %&gt;% signif(sigfig) %&gt;% scales::dollar(accuracy = accuracy, scale = .001, suffix = &quot;k&quot;)
    } else {
      label_text &lt;- df$var %&gt;% signif(sigfig) %&gt;% scales::dollar(accuracy = .01)
    }
  } else if (stringr::str_detect(y_title, &quot;Percent&quot;)) {
    label_text &lt;- df$var %&gt;% signif(sigfig) %&gt;% scales::percent(accuracy = accuracy, scale = 1, suffix = &quot;%&quot;)
  } else {
    label_text &lt;- df$var %&gt;% signif(sigfig) %&gt;% scales::comma(accuracy = accuracy)
  }

  # Set text format, highlight and italicise Louisville text, highlight Louisville bar
  df$textcolor &lt;- &quot;#000000&quot;
  df$textcolor[df$city == &quot;Louisville&quot;] &lt;- &quot;#000000&quot;
  
  df$textfont &lt;- &quot;Montserrat&quot;
  df$textfont[df$city == &quot;Louisville&quot;] &lt;- &quot;Montserrat Bold&quot;
  
  label_color_names &lt;- c(&quot;white&quot;, &quot;black&quot;)
  label_color_values &lt;- c(&quot;#000000&quot;, &quot;#ffffff&quot;)
  
  df$label_color &lt;- &quot;white&quot;
  df$label_color[df$city == &quot;Louisville&quot;] &lt;- &quot;black&quot;
  #df$linecolor &lt;- &quot;#ffffff&quot;
  #df$linecolor[df$city == &quot;Louisville&quot;] &lt;- &quot;#00a9b7&quot;
  df$lou &lt;- if_else(df$city == &quot;Louisville&quot;, 1, 0)
  df$text_alignment &lt;- 1.1
  if (!is.null(alternate_text)) df$text_alignment[df$rank %in% alternate_text] &lt;- -0.1
  ### PLOT GRAPH
  
  # Initial plot
  p &lt;- ggplot(data = df,
              aes(x = factor(names, levels = rev(names)),
                  y = var,
                  fill  = factor(color, levels = color_names, ordered = TRUE)))
  p &lt;- p + guides(fill = FALSE, color = FALSE)
  # Add bars
  p &lt;- p +
    geom_bar(stat = &quot;identity&quot;,
             size = text_size) +
    coord_flip() +
    ggthemes::theme_tufte()
  p &lt;- p + scale_fill_manual(values = color_values)
  #p &lt;- p + scale_color_manual(values = c(&quot;#ffffff&quot;, &quot;#00a9b7&quot;))
  # Add features
  title_scale &lt;- min(1, 48 / nchar(plot_title))
  p &lt;- p + theme(text = element_text(family = &quot;Montserrat&quot;),
                 plot.title = element_text(size = 14 * title_scale * text_size, hjust = 0.5, margin = margin(b = 10, unit = &quot;pt&quot;)),
                 axis.text.y = element_text(hjust = 0,
                                            size = 10 * text_size, 
                                            color = rev(df$textcolor),
                                            family = rev(df$textfont)),
                 axis.title.x = element_text(size = 10 * text_size),
                 axis.ticks = element_blank(),
                 axis.text.x = element_blank(),
                 plot.caption = element_text(size = 5 * text_size, lineheight = 0.5))
  if(subtitle_text != &quot;&quot;){
    p &lt;- p + theme(plot.subtitle = element_text(hjust = 0.5, size = 5 * text_size)) +
      labs(subtitle = subtitle_text)
  }
  # Add numeric labels to bars based on bar_label parameter
  if (y_title != &quot;&quot; &amp; bar_label) {
    p &lt;- p + geom_text(aes(label = label_text, 
                           hjust = text_alignment, 
                           color = factor(label_color),
                           family = textfont),
                       size = 4.5 * text_size) +
       scale_colour_manual(values=c(&quot;#000000&quot;, &quot;#ffffff&quot;))
    }
  # Add vertical line to the left side of the bars based on the h_line parameter
  if (min(df$var, na.rm = TRUE) &lt; 0) p &lt;- p + geom_hline(yintercept = 0, linetype = &quot;longdash&quot;, size = 2)
  # Add remaining text
  p &lt;- p + labs(title = plot_title, y = y_title,
                x = &quot;&quot;, caption = caption_text)
  
  p &lt;- p +
    theme(
      panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
      plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
      legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
      legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
      legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))
  
  p
}</code></pre>
<div id="cost-burdened-renters" class="section level2">
<h2>Cost Burdened Renters</h2>
<pre class="r"><code>#Data was pulled in Python file get_data.py and written to .csv
df &lt;- read_csv(&quot;low_income_renters.csv&quot;)

## This code is modified from the urban institute: https://github.com/UrbanInstitute/covid-rental-risk-index/blob/master/scripts/01_generate_index_variables.R

# Calculate percent of households making under 35k who pay more than 50% of their
# income on rent
df &lt;- df %&gt;%
  # select ACS table variables w/ attached GEOID
  select(
    NAME,
    # These are all the peolpe making under 35k (denominator)
    B25074_002E,
    B25074_011E,
    B25074_020E,
    # These are all the people making under 35k who pay more than 50% of their income on rent (numerator)
    B25074_009E,
    B25074_018E,
    B25074_027E,
    # These are the people making under 35k for whom this metric wasn&#39;t computed
    # and they therefore need to be subtracted from the denominator
    B25074_010E,
    B25074_019E,
    B25074_028E
  )  %&gt;%
  #rename both county and city to just St. Louis
  mutate(NAME = if_else(str_detect(NAME, &quot;St. Louis&quot;), &quot;St. Louis&quot;, NAME)) %&gt;%
  group_by(NAME) %&gt;%
  #use summarize across instead to save space and make reusable in a function
  summarize(
    B25074_002E = sum(B25074_002E),
    B25074_011E = sum(B25074_011E),
    B25074_020E = sum(B25074_020E),
    B25074_009E = sum(B25074_009E),
    B25074_018E = sum(B25074_018E),
    B25074_027E = sum(B25074_027E),
    B25074_010E = sum(B25074_010E),
    B25074_019E = sum(B25074_019E),
    B25074_028E = sum(B25074_028E)
  ) %&gt;%
  # create cost burden variable w/ calculation
  mutate(
    perc_cost_burdened_under_35k = (B25074_009E + B25074_018E + B25074_027E) /
      (
        B25074_002E + B25074_011E + B25074_020E - B25074_010E - B25074_019E -
          B25074_028E
      ),
    #cd add
    perc_cost_burdened_under_35k =
      if_else(
        B25074_002E + B25074_011E + B25074_020E == 0,
        0,
        perc_cost_burdened_under_35k
      )
  )

# Clean up for graph
df &lt;- df %&gt;%
  mutate(city = recode(NAME,
                       `Davidson County, Tennessee` = &quot;Nashville&quot;,
                       `Douglas County, Nebraska` = &quot;Omaha&quot;,
                       `Franklin County, Ohio` = &quot;Columbus&quot;,
                       `Greenville County, South Carolina` = &quot;Greenville&quot;,
                       `Guilford County, North Carolina` = &quot;Greensboro&quot;,
                       `Hamilton County, Ohio` = &quot;Cincinnati&quot;,
                       `Jackson County, Missouri` = &quot;Kansas City&quot;,
                       `Jefferson County, Alabama` = &quot;Birmingham&quot;,
                       `Jefferson County, Kentucky` = &quot;Louisville&quot;,
                       `Kent County, Michigan` = &quot;Grand Rapids&quot;,
                       `Knox County, Tennessee` = &quot;Knoxville&quot;,
                       `Marion County, Indiana` = &quot;Indianapolis&quot;,
                       `Mecklenburg County, North Carolina` = &quot;Charlotte&quot;,
                       `Oklahoma County, Oklahoma` = &quot;Oklahoma City&quot;,
                       `Shelby County, Tennessee` = &quot;Memphis&quot;,
                       `Tulsa County, Oklahoma` = &quot;Tulsa&quot;),
         perc_cost_burdened_under_35k = 100 * perc_cost_burdened_under_35k) 

plt_cost_burdened &lt;- ranking(df, &quot;perc_cost_burdened_under_35k&quot;, text_size = 2, order = &quot;ascending&quot;,
                             plot_title = &quot;Cost Burdened Renters in Households Making Under 35k &quot;)

plt_cost_burdened</code></pre>
<p><img src="index_files/figure-html/cost_burdened_renters_ranking-1.png" width="672" /></p>
</div>
<div id="overcrowding-1" class="section level2">
<h2>Overcrowding</h2>
<pre class="r"><code>#Data was pulled in Python file get_data.py and written to .csv
oc_df &lt;- read_csv(&quot;overcrowding.csv&quot;)

## This code is modified from the urban institute: https://github.com/UrbanInstitute/covid-rental-risk-index/blob/master/scripts/01_generate_index_variables.R

oc_df &lt;- oc_df %&gt;%
  # select ACS table variables w/ attached GEOID
  select(NAME, B25014_013E, B25014_012E, B25014_008E)  %&gt;%
  #rename both county and city to just St. Louis
  mutate(NAME = if_else(str_detect(NAME, &quot;St. Louis&quot;), &quot;St. Louis&quot;, NAME)) %&gt;%
  group_by(NAME) %&gt;%
  summarize(across(where(is.numeric), sum)) %&gt;%
   # create cost burden variable w/ calculation
  mutate(perc_overcrowding_renter_1.50_or_more = ((B25014_012E + B25014_013E) / B25014_008E),
         perc_overcrowding_renter_1.50_or_more = 
           if_else(B25014_008E == 0, 0, perc_overcrowding_renter_1.50_or_more))

# Clean up for graph
oc_df &lt;- oc_df %&gt;%
  mutate(city = recode(NAME,
                       `Davidson County, Tennessee` = &quot;Nashville&quot;,
                       `Douglas County, Nebraska` = &quot;Omaha&quot;,
                       `Franklin County, Ohio` = &quot;Columbus&quot;,
                       `Greenville County, South Carolina` = &quot;Greenville&quot;,
                       `Guilford County, North Carolina` = &quot;Greensboro&quot;,
                       `Hamilton County, Ohio` = &quot;Cincinnati&quot;,
                       `Jackson County, Missouri` = &quot;Kansas City&quot;,
                       `Jefferson County, Alabama` = &quot;Birmingham&quot;,
                       `Jefferson County, Kentucky` = &quot;Louisville&quot;,
                       `Kent County, Michigan` = &quot;Grand Rapids&quot;,
                       `Knox County, Tennessee` = &quot;Knoxville&quot;,
                       `Marion County, Indiana` = &quot;Indianapolis&quot;,
                       `Mecklenburg County, North Carolina` = &quot;Charlotte&quot;,
                       `Oklahoma County, Oklahoma` = &quot;Oklahoma City&quot;,
                       `Shelby County, Tennessee` = &quot;Memphis&quot;,
                       `Tulsa County, Oklahoma` = &quot;Tulsa&quot;),
         perc_overcrowding_renter_1.50_or_more = 100 * perc_overcrowding_renter_1.50_or_more) 

plt_oc &lt;- ranking(oc_df, &quot;perc_overcrowding_renter_1.50_or_more&quot;, text_size = 2, order = &quot;ascending&quot;,
                             plot_title = &quot;Overcrowding&quot;)

plt_oc</code></pre>
<p><img src="index_files/figure-html/overcrowding_ranking-1.png" width="672" /></p>
</div>
<div id="unemployment" class="section level2">
<h2>Unemployment</h2>
<pre class="r"><code>#Data was pulled in Python file get_data.py and written to .csv
un_df &lt;- read_csv(&quot;unemployed.csv&quot;)

## This code is modified from the urban institute: https://github.com/UrbanInstitute/covid-rental-risk-index/blob/master/scripts/01_generate_index_variables.R
un_df &lt;- un_df %&gt;%
  # select ACS table variables w/ attached GEOID
  select(B12006_055E, B12006_050E, B12006_011E, B12006_006E, B12006_022E, B12006_017E, B12006_033E, B12006_028E, B12006_044E, B12006_039E, B12006_053E, B12006_048E, B12006_009E, B12006_004E, B12006_020E, B12006_015E, B12006_031E, B12006_026E, B12006_042E, B12006_037E, NAME) %&gt;%
  # collapse St. Louis into one
  mutate(NAME = if_else(str_detect(NAME, &quot;St. Louis&quot;), &quot;St. Louis&quot;, NAME)) %&gt;%
  group_by(NAME) %&gt;%
  summarize(across(where(is.numeric), sum)) %&gt;%
  # create unemployed variable w/ calculation
  mutate(perc_unemployed_laborforce = ((B12006_055E + B12006_050E + B12006_011E + B12006_006E + B12006_022E + B12006_017E + B12006_033E + B12006_028E + B12006_044E + B12006_039E) / (B12006_053E + B12006_048E + B12006_009E + B12006_004E + B12006_020E + B12006_015E + B12006_031E + B12006_026E + B12006_042E + B12006_037E)),
         perc_unemployed_laborforce = 
           if_else(B12006_053E + B12006_048E + B12006_009E + B12006_004E + B12006_020E + B12006_015E + B12006_031E + B12006_026E + B12006_042E + B12006_037E == 0, 0,
                   perc_unemployed_laborforce))

# Clean up for graph
un_df &lt;- un_df %&gt;%
  mutate(city = recode(NAME,
                       `Davidson County, Tennessee` = &quot;Nashville&quot;,
                       `Douglas County, Nebraska` = &quot;Omaha&quot;,
                       `Franklin County, Ohio` = &quot;Columbus&quot;,
                       `Greenville County, South Carolina` = &quot;Greenville&quot;,
                       `Guilford County, North Carolina` = &quot;Greensboro&quot;,
                       `Hamilton County, Ohio` = &quot;Cincinnati&quot;,
                       `Jackson County, Missouri` = &quot;Kansas City&quot;,
                       `Jefferson County, Alabama` = &quot;Birmingham&quot;,
                       `Jefferson County, Kentucky` = &quot;Louisville&quot;,
                       `Kent County, Michigan` = &quot;Grand Rapids&quot;,
                       `Knox County, Tennessee` = &quot;Knoxville&quot;,
                       `Marion County, Indiana` = &quot;Indianapolis&quot;,
                       `Mecklenburg County, North Carolina` = &quot;Charlotte&quot;,
                       `Oklahoma County, Oklahoma` = &quot;Oklahoma City&quot;,
                       `Shelby County, Tennessee` = &quot;Memphis&quot;,
                       `Tulsa County, Oklahoma` = &quot;Tulsa&quot;),
         perc_unemployed_laborforce = 100 * perc_unemployed_laborforce) 

plt_un &lt;- ranking(un_df, &quot;perc_unemployed_laborforce&quot;, text_size = 2, order = &quot;ascending&quot;,
                             plot_title = &quot;Unemployed&quot;)

plt_un</code></pre>
<p><img src="index_files/figure-html/unemployment_ranking-1.png" width="672" /></p>
</div>
<div id="share-renting" class="section level2">
<h2>Share renting</h2>
<pre class="r"><code>#Data was pulled in Python file get_data.py and written to .csv
sr_df &lt;- read_csv(&quot;share_renting.csv&quot;)

## This code is modified from the urban institute: https://github.com/UrbanInstitute/covid-rental-risk-index/blob/master/scripts/01_generate_index_variables.R
sr_df &lt;- sr_df %&gt;%
  # select ACS table variables w/ attached GEOID
  select(B25003_003E, B25003_001E, NAME) %&gt;%
  # collapse St. Louis into one
  mutate(NAME = if_else(str_detect(NAME, &quot;St. Louis&quot;), &quot;St. Louis&quot;, NAME)) %&gt;%
  group_by(NAME) %&gt;%
  summarize(across(where(is.numeric), sum)) %&gt;%
  # create perc_renters variable w/ calculation
  mutate(perc_renters = (B25003_003E / B25003_001E),
         perc_renters = if_else(B25003_001E == 0, 0, perc_renters),
         num_renters = B25003_003E)

# Clean up for graph
sr_df &lt;- sr_df %&gt;%
  mutate(city = recode(NAME,
                       `Davidson County, Tennessee` = &quot;Nashville&quot;,
                       `Douglas County, Nebraska` = &quot;Omaha&quot;,
                       `Franklin County, Ohio` = &quot;Columbus&quot;,
                       `Greenville County, South Carolina` = &quot;Greenville&quot;,
                       `Guilford County, North Carolina` = &quot;Greensboro&quot;,
                       `Hamilton County, Ohio` = &quot;Cincinnati&quot;,
                       `Jackson County, Missouri` = &quot;Kansas City&quot;,
                       `Jefferson County, Alabama` = &quot;Birmingham&quot;,
                       `Jefferson County, Kentucky` = &quot;Louisville&quot;,
                       `Kent County, Michigan` = &quot;Grand Rapids&quot;,
                       `Knox County, Tennessee` = &quot;Knoxville&quot;,
                       `Marion County, Indiana` = &quot;Indianapolis&quot;,
                       `Mecklenburg County, North Carolina` = &quot;Charlotte&quot;,
                       `Oklahoma County, Oklahoma` = &quot;Oklahoma City&quot;,
                       `Shelby County, Tennessee` = &quot;Memphis&quot;,
                       `Tulsa County, Oklahoma` = &quot;Tulsa&quot;),
         perc_renters = 100 * perc_renters) 

plt_sr &lt;- ranking(sr_df, &quot;perc_renters&quot;, text_size = 2, order = &quot;ascending&quot;,
                             plot_title = &quot;Percent Renters&quot;)

plt_sr</code></pre>
<p><img src="index_files/figure-html/renters_ranking-1.png" width="672" /></p>
</div>
<div id="poverty-1" class="section level2">
<h2>Poverty</h2>
<pre class="r"><code>#Data was pulled in Python file get_data.py and written to .csv
pv_df &lt;- read_csv(&quot;poverty.csv&quot;)

## This code is modified from the urban institute: https://github.com/UrbanInstitute/covid-rental-risk-index/blob/master/scripts/01_generate_index_variables.R
pv_df &lt;- pv_df %&gt;%
  # select ACS table variables w/ attached GEOID
select(C17002_002E, C17002_003E, C17002_001E, NAME) %&gt;%  
  # collapse St. Louis into one
  mutate(NAME = if_else(str_detect(NAME, &quot;St. Louis&quot;), &quot;St. Louis&quot;, NAME)) %&gt;%
  group_by(NAME) %&gt;%
  summarize(across(where(is.numeric), sum)) %&gt;%
  # create poverty variable w/ calculation
  mutate(perc_poverty_12mnth = ((C17002_002E + C17002_003E) / C17002_001E),
         perc_poverty_12mnth = 
           if_else(C17002_001E == 0, 0, perc_poverty_12mnth))

# Clean up for graph
pv_df &lt;- pv_df %&gt;%
  mutate(city = recode(NAME,
                       `Davidson County, Tennessee` = &quot;Nashville&quot;,
                       `Douglas County, Nebraska` = &quot;Omaha&quot;,
                       `Franklin County, Ohio` = &quot;Columbus&quot;,
                       `Greenville County, South Carolina` = &quot;Greenville&quot;,
                       `Guilford County, North Carolina` = &quot;Greensboro&quot;,
                       `Hamilton County, Ohio` = &quot;Cincinnati&quot;,
                       `Jackson County, Missouri` = &quot;Kansas City&quot;,
                       `Jefferson County, Alabama` = &quot;Birmingham&quot;,
                       `Jefferson County, Kentucky` = &quot;Louisville&quot;,
                       `Kent County, Michigan` = &quot;Grand Rapids&quot;,
                       `Knox County, Tennessee` = &quot;Knoxville&quot;,
                       `Marion County, Indiana` = &quot;Indianapolis&quot;,
                       `Mecklenburg County, North Carolina` = &quot;Charlotte&quot;,
                       `Oklahoma County, Oklahoma` = &quot;Oklahoma City&quot;,
                       `Shelby County, Tennessee` = &quot;Memphis&quot;,
                       `Tulsa County, Oklahoma` = &quot;Tulsa&quot;),
         perc_poverty_12mnth = 100 * perc_poverty_12mnth) 

plt_pv &lt;- ranking(pv_df, &quot;perc_poverty_12mnth&quot;, text_size = 2, order = &quot;ascending&quot;,
                             plot_title = &quot;Poverty&quot;)

plt_pv</code></pre>
<p><img src="index_files/figure-html/poverty_ranking-1.png" width="672" /></p>
</div>
</div>
<div id="metro-council-district-maps" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Metro Council District Maps</h1>
<div id="rental-insecurity-index-1" class="section level2">
<h2>Rental Insecurity Index</h2>
<pre class="r"><code># Read in cross walk
tract_to_district &lt;- read_csv(&quot;district_tract_crosswalk.csv&quot;) %&gt;%
  mutate(tract = as.character(tract))

# Join to data
district_level &lt;- df_index %&gt;%
  rename(tract = GEOID) %&gt;%
  # Remove airport to avoid dividing by zero
  filter(tract!= &quot;21111980100&quot;) %&gt;%
  # join crosswalk data to dataframe
  left_join(tract_to_district, by = &quot;tract&quot;) %&gt;%   
  # Group by district
  group_by(district) %&gt;%
  # join crosswalk data to dataframe
  summarise(across(where(is.numeric), ~sum(. * total)), .groups = &quot;drop&quot;)

# Shape files
metro_shp &lt;- readOGR(&quot;Council_Districts&quot;, layer = &quot;council_districts&quot;,
                     GDAL1_integer64_policy = TRUE, verbose = FALSE)

metro_sf &lt;- st_as_sf(metro_shp) %&gt;%
  rename(district = coundist)

metro_sf &lt;- full_join(metro_sf, district_level, by = &quot;district&quot;)

# Transform the percents
mult100 &lt;- function(x){
  x &lt;- x * 100
}

metro_sf &lt;- metro_sf %&gt;%
  mutate(across(starts_with(&quot;perc_&quot;), mult100))

load(&quot;district_label_points.RData&quot;)

district_label_points %&lt;&gt;%
  mutate(
    x = unname(st_coordinates(.)[,1]),
    y = unname(st_coordinates(.)[,2]))

write_csv(st_drop_geometry(metro_sf), &quot;metro_data.csv&quot;)

metro_map &lt;- function(indicator, title = &quot;&quot;, legend = &quot;&quot;, caption = &quot;&quot;, no_legend = FALSE){

  plt &lt;- ggplot(metro_sf) + 
    geom_sf(aes(fill={{ indicator }} )) +
    # Add District labels 
    shadowtext::geom_shadowtext(data = district_label_points,
                                aes(x = x, y=y, label = district),
                                family = &quot;Montserrat Bold&quot;, size = 8,
                                color = &quot;white&quot;, bg.color=&quot;black&quot;) +
    #geom_sf(data = district_label_points, aes(color =district)) +
    #geom_sf_text(aes(label = district), color = &quot;white&quot;) +
    #geom_sf_text(aes(label = district), size = 6, color = &quot;#ffffff&quot;,
    #             fun.geometry = function(x) st_buffer(x, dist = buffers, singleSide = T) %&gt;% st_point_on_surface()) +
    # scale_fill_gradient(low = &quot;#323844&quot;, high = &quot;#d63631&quot;, name = legend) +
    scale_fill_viridis(na.value = &quot;grey&quot;, name = legend) +
    theme_bw(base_size = 22, base_family = &quot;Montserrat&quot;) +
    theme(plot.caption = element_text(lineheight = .5)) +
    theme(panel.grid = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank(),
          axis.title = element_blank(),
          panel.border = element_blank()) +
    labs(title = title,
         caption = caption)
  
  if (no_legend == TRUE){
    plt &lt;- plt + theme(legend.position = &quot;none&quot;)
  }
  
  plt &lt;- plt +
    theme(
      panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
      plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
      legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
      legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
      legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))
  
  return(plt)
}

metro_map(overall_index, title = &quot;Rental Insecurity Index&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher rental insecurity. \n This is the Urban Institute&#39;s Emergency Rental Assistance Priority Index modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/rental_insecurity_index_council-1.png" width="672" /></p>
</div>
<div id="housing-instability-subindex-1" class="section level2">
<h2>Housing Instability Subindex</h2>
<pre class="r"><code>metro_map(housing_instability_index, title = &quot;Housing Instability Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher housing instability. \n This is the Urban Institute&#39;s Housing Instability subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/housing_instability_subindex_council-1.png" width="672" /></p>
</div>
<div id="covid-19-impact-subindex-1" class="section level2">
<h2>Covid 19 Impact Subindex</h2>
<pre class="r"><code>metro_map(covid_index, title = &quot;Covid Instability Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher covid instability. \n This is the Urban Institute&#39;s Covid Instability subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/covid_19_impact_subindex_council-1.png" width="672" /></p>
</div>
<div id="equity-subindex-1" class="section level2">
<h2>Equity Subindex</h2>
<pre class="r"><code>metro_map(equity_index, title = &quot;Equity Subindex&quot;, 
         legend = &quot;Compared to \n other tracts&quot;, 
         caption = &quot;Lighter shades indicate higher prioritization based on equity. \n This is the Urban Institute&#39;s Equity subindex modified \nto compare Louisville to its peer cities (instead of to other areas in Kentucky). \n Greyed out areas had insufficient data for the index&quot;,
         no_legend = TRUE)</code></pre>
<p><img src="index_files/figure-html/equity_subindex_council-1.png" width="672" /></p>
</div>
<div id="poverty-2" class="section level2">
<h2>Poverty</h2>
<pre class="r"><code>metro_map(perc_poverty_12mnth, title = &quot;Poverty&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of each census tract that is in poverty. \n Data from Urban Institute.&quot;)</code></pre>
<p><img src="index_files/figure-html/poverty_council-1.png" width="672" /></p>
</div>
<div id="percent-renting-1" class="section level2">
<h2>Percent Renting</h2>
<pre class="r"><code>metro_map(perc_renters, title = &quot;Percent of Renter Occupied Housing Units&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of each tract that rents. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/renting_council-1.png" width="672" /></p>
</div>
<div id="cost-burdened-housholds-1" class="section level2">
<h2>Cost-burdened housholds</h2>
<pre class="r"><code>metro_map(perc_cost_burdened_under_35k, title = &quot;Costburdened Households making under 35k&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of households making less than 35,000 and paying more than 50% of their income in rent. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/cost_burdened_council-1.png" width="672" /></p>
</div>
<div id="overcrowding-2" class="section level2">
<h2>Overcrowding</h2>
<pre class="r"><code>metro_map(perc_overcrowding_renter_1.50_or_more, title = &quot;Overcrowding in Rental Housing&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of households renting and with more than 1.5 people per room. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/overcrowding_council-1.png" width="672" /></p>
</div>
<div id="unemployed-1" class="section level2">
<h2>Unemployed</h2>
<pre class="r"><code>metro_map(perc_unemployed_laborforce, title = &quot;Unemployment&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of people unemployed but still in the labor force (actively seeking work). \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/unemployed_council-1.png" width="672" /></p>
</div>
<div id="no-health-insurance-1" class="section level2">
<h2>No Health Insurance</h2>
<pre class="r"><code>metro_map(perc_no_hinsure, title = &quot;No Health Insurance&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent without health insurance. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/no_health_insurance_council-1.png" width="672" /></p>
</div>
<div id="low-income-jobs-lost-to-covid-1" class="section level2">
<h2>Low Income Jobs Lost to Covid</h2>
<pre class="r"><code>metro_map(perc_low_income_jobs_lost, title = &quot;Low Income Jobs Lost to Covid&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Estimate from the Urban Institute based on job categories in the each tract. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/low_income_job_loss_council-1.png" width="672" /></p>
</div>
<div id="percent-poc-1" class="section level2">
<h2>Percent PoC</h2>
<pre class="r"><code>metro_map(perc_person_of_color, title = &quot;Percent Persons of Color&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent of persons in the area who identify as persons of color. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/people_of_color_council-1.png" width="672" /></p>
</div>
<div id="extremely-low-income-1" class="section level2">
<h2>Extremely Low Income</h2>
<pre class="r"><code>metro_map(perc_30hamfi, title = &quot;Extremely Low Income&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Renter occupied household making less than 30 percent of area median income. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/extremely_low_income_council-1.png" width="672" /></p>
</div>
<div id="public-assistance-1" class="section level2">
<h2>Public Assistance</h2>
<pre class="r"><code>metro_map(perc_public_assistance, title = &quot;Recieving Public Assistance&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent receiving some form of public assistance like SNAP or TANF. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/public_assistance_council-1.png" width="672" /></p>
</div>
<div id="foreign-born-1" class="section level2">
<h2>Foreign Born</h2>
<pre class="r"><code>metro_map(perc_foreign_born, title = &quot;Foreign Born&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Percent born outside the U.S. \n Data from Urban Institute&quot;)</code></pre>
<p><img src="index_files/figure-html/foreign_born_council-1.png" width="672" /></p>
</div>
</div>
<div id="metro-council-tables" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Metro Council Tables</h1>
<div id="housing-subindex" class="section level2">
<h2>Housing Subindex</h2>
<pre class="r"><code>library(gt)

metro_house_tbl &lt;- metro_sf %&gt;%
  st_drop_geometry() %&gt;%
  filter(!is.na(district)) %&gt;%
  select(district, perc_cost_burdened_under_35k, perc_renters, perc_poverty_12mnth, perc_unemployed_laborforce, perc_overcrowding_renter_1.50_or_more, housing_instability_index) %&gt;%
  #GT fmt_percent expects percents as decimals
  mutate(across(starts_with(&quot;perc&quot;), ~ ./100)) %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Table 1: Housing Indicators&quot;,
             subtitle = &quot;Components of the Housing Instability Subindex&quot;) %&gt;%
  fmt_number(columns = vars(housing_instability_index),
             n_sigfig = 2,
             suffixing = TRUE) %&gt;%
  fmt_percent(columns = vars(perc_cost_burdened_under_35k, perc_renters, perc_poverty_12mnth, perc_unemployed_laborforce, perc_overcrowding_renter_1.50_or_more),
              decimals = 0) %&gt;%
  cols_label(district = &quot;Metro District&quot;,
             perc_cost_burdened_under_35k = &quot;Cost Burdened&quot;,
             perc_renters = &quot;Renting&quot;, 
             perc_poverty_12mnth = &quot;Poverty&quot;, 
             perc_unemployed_laborforce = &quot;Unemployed&quot;, 
             perc_overcrowding_renter_1.50_or_more = &quot;Overcrowding&quot;,
             housing_instability_index = &quot;Index&quot;) %&gt;%
  cols_move(columns = vars(perc_cost_burdened_under_35k, perc_renters, perc_poverty_12mnth, perc_unemployed_laborforce, perc_overcrowding_renter_1.50_or_more, housing_instability_index),
            after = vars(district)) %&gt;%
  tab_spanner(
    label = &quot;Index&quot;,
    columns = vars(housing_instability_index)
  ) %&gt;%
  tab_spanner(
    label = &quot;Percent&quot;,
    columns = vars(perc_cost_burdened_under_35k, perc_renters, perc_poverty_12mnth, perc_unemployed_laborforce, perc_overcrowding_renter_1.50_or_more)
  ) %&gt;%
  cols_align(align = &quot;center&quot;) %&gt;%
    tab_source_note(
    source_note = md(&quot;Greater Louisville Project&quot;)
  ) %&gt;%
  tab_source_note(
    source_note = md(&quot;Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.&quot;)
  ) %&gt;%
  opt_row_striping(row_striping = TRUE) %&gt;%
  opt_table_outline() %&gt;%
  tab_options(
    table.font.size = px(12),
    table.width = pct(50)
  ) 

metro_house_tbl</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uofmwfoocp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 50%;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D3D3D3;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D3D3D3;
}

#uofmwfoocp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uofmwfoocp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uofmwfoocp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uofmwfoocp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uofmwfoocp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uofmwfoocp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uofmwfoocp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uofmwfoocp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uofmwfoocp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uofmwfoocp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uofmwfoocp .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uofmwfoocp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uofmwfoocp .gt_from_md > :first-child {
  margin-top: 0;
}

#uofmwfoocp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uofmwfoocp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uofmwfoocp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#uofmwfoocp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uofmwfoocp .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#uofmwfoocp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uofmwfoocp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uofmwfoocp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uofmwfoocp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uofmwfoocp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uofmwfoocp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#uofmwfoocp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uofmwfoocp .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#uofmwfoocp .gt_left {
  text-align: left;
}

#uofmwfoocp .gt_center {
  text-align: center;
}

#uofmwfoocp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uofmwfoocp .gt_font_normal {
  font-weight: normal;
}

#uofmwfoocp .gt_font_bold {
  font-weight: bold;
}

#uofmwfoocp .gt_font_italic {
  font-style: italic;
}

#uofmwfoocp .gt_super {
  font-size: 65%;
}

#uofmwfoocp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="uofmwfoocp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="7" class="gt_heading gt_title gt_font_normal" style>Table 1: Housing Indicators</th>
    </tr>
    <tr>
      <th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Components of the Housing Instability Subindex</th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">Metro District</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="5">
        <span class="gt_column_spanner">Percent</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="1">
        <span class="gt_column_spanner">Index</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Cost Burdened</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Renting</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Poverty</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Unemployed</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Overcrowding</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Index</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">47&percnt;</td>
      <td class="gt_row gt_center">45&percnt;</td>
      <td class="gt_row gt_center">24&percnt;</td>
      <td class="gt_row gt_center">12&percnt;</td>
      <td class="gt_row gt_center">0&percnt;</td>
      <td class="gt_row gt_center">0.22</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">51&percnt;</td>
      <td class="gt_row gt_center gt_striped">50&percnt;</td>
      <td class="gt_row gt_center gt_striped">20&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.33</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">46&percnt;</td>
      <td class="gt_row gt_center">47&percnt;</td>
      <td class="gt_row gt_center">26&percnt;</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">0.27</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">35&percnt;</td>
      <td class="gt_row gt_center gt_striped">80&percnt;</td>
      <td class="gt_row gt_center gt_striped">43&percnt;</td>
      <td class="gt_row gt_center gt_striped">17&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.97</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">47&percnt;</td>
      <td class="gt_row gt_center">57&percnt;</td>
      <td class="gt_row gt_center">34&percnt;</td>
      <td class="gt_row gt_center">17&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">0.73</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">6</td>
      <td class="gt_row gt_center gt_striped">40&percnt;</td>
      <td class="gt_row gt_center gt_striped">77&percnt;</td>
      <td class="gt_row gt_center gt_striped">43&percnt;</td>
      <td class="gt_row gt_center gt_striped">11&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.75</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">64&percnt;</td>
      <td class="gt_row gt_center">27&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">3&percnt;</td>
      <td class="gt_row gt_center">0&percnt;</td>
      <td class="gt_row gt_center">&minus;0.35</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">8</td>
      <td class="gt_row gt_center gt_striped">38&percnt;</td>
      <td class="gt_row gt_center gt_striped">32&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.46</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">9</td>
      <td class="gt_row gt_center">41&percnt;</td>
      <td class="gt_row gt_center">42&percnt;</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">0&percnt;</td>
      <td class="gt_row gt_center">&minus;0.36</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">10</td>
      <td class="gt_row gt_center gt_striped">47&percnt;</td>
      <td class="gt_row gt_center gt_striped">41&percnt;</td>
      <td class="gt_row gt_center gt_striped">15&percnt;</td>
      <td class="gt_row gt_center gt_striped">6&percnt;</td>
      <td class="gt_row gt_center gt_striped">0&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.15</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">11</td>
      <td class="gt_row gt_center">32&percnt;</td>
      <td class="gt_row gt_center">29&percnt;</td>
      <td class="gt_row gt_center">7&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.49</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">12</td>
      <td class="gt_row gt_center gt_striped">49&percnt;</td>
      <td class="gt_row gt_center gt_striped">32&percnt;</td>
      <td class="gt_row gt_center gt_striped">12&percnt;</td>
      <td class="gt_row gt_center gt_striped">6&percnt;</td>
      <td class="gt_row gt_center gt_striped">2&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.16</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">13</td>
      <td class="gt_row gt_center">35&percnt;</td>
      <td class="gt_row gt_center">39&percnt;</td>
      <td class="gt_row gt_center">17&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.21</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">14</td>
      <td class="gt_row gt_center gt_striped">50&percnt;</td>
      <td class="gt_row gt_center gt_striped">23&percnt;</td>
      <td class="gt_row gt_center gt_striped">16&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">0&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.32</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">15</td>
      <td class="gt_row gt_center">41&percnt;</td>
      <td class="gt_row gt_center">55&percnt;</td>
      <td class="gt_row gt_center">26&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">0.28</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">16</td>
      <td class="gt_row gt_center gt_striped">66&percnt;</td>
      <td class="gt_row gt_center gt_striped">19&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.32</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">17</td>
      <td class="gt_row gt_center">64&percnt;</td>
      <td class="gt_row gt_center">26&percnt;</td>
      <td class="gt_row gt_center">7&percnt;</td>
      <td class="gt_row gt_center">3&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.31</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">18</td>
      <td class="gt_row gt_center gt_striped">56&percnt;</td>
      <td class="gt_row gt_center gt_striped">37&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.29</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">19</td>
      <td class="gt_row gt_center">70&percnt;</td>
      <td class="gt_row gt_center">21&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.29</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">20</td>
      <td class="gt_row gt_center gt_striped">47&percnt;</td>
      <td class="gt_row gt_center gt_striped">17&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.57</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">21</td>
      <td class="gt_row gt_center">50&percnt;</td>
      <td class="gt_row gt_center">49&percnt;</td>
      <td class="gt_row gt_center">22&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">0.077</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">22</td>
      <td class="gt_row gt_center gt_striped">36&percnt;</td>
      <td class="gt_row gt_center gt_striped">21&percnt;</td>
      <td class="gt_row gt_center gt_striped">6&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">2&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.51</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">23</td>
      <td class="gt_row gt_center">41&percnt;</td>
      <td class="gt_row gt_center">19&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.52</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">24</td>
      <td class="gt_row gt_center gt_striped">48&percnt;</td>
      <td class="gt_row gt_center gt_striped">37&percnt;</td>
      <td class="gt_row gt_center gt_striped">14&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.12</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">25</td>
      <td class="gt_row gt_center">34&percnt;</td>
      <td class="gt_row gt_center">34&percnt;</td>
      <td class="gt_row gt_center">11&percnt;</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">&minus;0.39</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">26</td>
      <td class="gt_row gt_center gt_striped">52&percnt;</td>
      <td class="gt_row gt_center gt_striped">40&percnt;</td>
      <td class="gt_row gt_center gt_striped">12&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.18</td>
    </tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="7">Greater Louisville Project</td>
    </tr>
    <tr>
      <td class="gt_sourcenote" colspan="7">Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.</td>
    </tr>
  </tfoot>
  
</table></div>
</div>
<div id="covid-subindex" class="section level2">
<h2>Covid Subindex</h2>
<pre class="r"><code>metro_covid_tbl &lt;- metro_sf %&gt;%
  st_drop_geometry() %&gt;%
  filter(!is.na(district)) %&gt;%
  select(district, perc_no_hinsure, perc_low_income_jobs_lost, covid_index) %&gt;%
  #GT fmt_percent expects percents as decimals
  mutate(across(starts_with(&quot;perc&quot;), ~ ./100)) %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Table 2: Covid Indicators&quot;,
             subtitle = &quot;Components of the Covid Subindex&quot;) %&gt;%
  fmt_number(columns = vars(covid_index),
             n_sigfig = 2,
             suffixing = TRUE) %&gt;%
  fmt_percent(columns = vars(perc_no_hinsure, perc_low_income_jobs_lost),
              decimals = 0) %&gt;%
  cols_label(district = &quot;Metro District&quot;,
             perc_no_hinsure = &quot;No Health Insurance&quot;, 
             perc_low_income_jobs_lost = &quot;Covid Job Loss&quot;, 
             covid_index = &quot;Covid Index&quot;) %&gt;%
  cols_move(columns = vars(perc_no_hinsure, perc_low_income_jobs_lost, covid_index),
            after = vars(district)) %&gt;%
  tab_spanner(
    label = &quot;Index&quot;,
    columns = vars(covid_index)
  ) %&gt;%
  tab_spanner(
    label = &quot;Percent&quot;,
    columns = vars(perc_no_hinsure, perc_low_income_jobs_lost)
  ) %&gt;%
  cols_align(align = &quot;center&quot;) %&gt;%
  tab_source_note(
    source_note = md(&quot;Greater Louisville Project&quot;)
  ) %&gt;%
  tab_source_note(
    source_note = md(&quot;Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.&quot;)
  ) %&gt;%
  opt_row_striping(row_striping = TRUE) %&gt;%
  opt_table_outline() %&gt;%
  tab_options(
    table.font.size = px(12),
    table.width = pct(50)
  ) 

metro_covid_tbl</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#kjptdsenfr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 50%;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D3D3D3;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D3D3D3;
}

#kjptdsenfr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kjptdsenfr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kjptdsenfr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kjptdsenfr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kjptdsenfr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kjptdsenfr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kjptdsenfr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kjptdsenfr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kjptdsenfr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kjptdsenfr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kjptdsenfr .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#kjptdsenfr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kjptdsenfr .gt_from_md > :first-child {
  margin-top: 0;
}

#kjptdsenfr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kjptdsenfr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kjptdsenfr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#kjptdsenfr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kjptdsenfr .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#kjptdsenfr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kjptdsenfr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kjptdsenfr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kjptdsenfr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kjptdsenfr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kjptdsenfr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#kjptdsenfr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kjptdsenfr .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#kjptdsenfr .gt_left {
  text-align: left;
}

#kjptdsenfr .gt_center {
  text-align: center;
}

#kjptdsenfr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kjptdsenfr .gt_font_normal {
  font-weight: normal;
}

#kjptdsenfr .gt_font_bold {
  font-weight: bold;
}

#kjptdsenfr .gt_font_italic {
  font-style: italic;
}

#kjptdsenfr .gt_super {
  font-size: 65%;
}

#kjptdsenfr .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="kjptdsenfr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>Table 2: Covid Indicators</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Components of the Covid Subindex</th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">Metro District</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2">
        <span class="gt_column_spanner">Percent</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="1">
        <span class="gt_column_spanner">Index</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">No Health Insurance</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Covid Job Loss</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Covid Index</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.18</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">14&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.012</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.098</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">10&percnt;</td>
      <td class="gt_row gt_center gt_striped">10&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.011</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.082</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">6</td>
      <td class="gt_row gt_center gt_striped">11&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.0010</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.20</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">8</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.34</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">9</td>
      <td class="gt_row gt_center">7&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.22</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">10</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.20</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">11</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.41</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">12</td>
      <td class="gt_row gt_center gt_striped">7&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.42</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">13</td>
      <td class="gt_row gt_center">13&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">&minus;0.17</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">14</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.42</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">15</td>
      <td class="gt_row gt_center">12&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.046</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">16</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">10&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.24</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">17</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">&minus;0.16</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">18</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.28</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">19</td>
      <td class="gt_row gt_center">3&percnt;</td>
      <td class="gt_row gt_center">9&percnt;</td>
      <td class="gt_row gt_center">&minus;0.36</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">20</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.49</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">21</td>
      <td class="gt_row gt_center">14&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">&minus;0.017</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">22</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.44</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">23</td>
      <td class="gt_row gt_center">7&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">&minus;0.38</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">24</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.29</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">25</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">&minus;0.38</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">26</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.17</td>
    </tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">Greater Louisville Project</td>
    </tr>
    <tr>
      <td class="gt_sourcenote" colspan="4">Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.</td>
    </tr>
  </tfoot>
  
</table></div>
</div>
<div id="equity-index-2" class="section level2">
<h2>Equity Index</h2>
<pre class="r"><code>metro_equity_tbl &lt;- metro_sf %&gt;%
  st_drop_geometry() %&gt;%
  filter(!is.na(district)) %&gt;%
  select(district, perc_person_of_color, perc_30hamfi, perc_public_assistance, perc_foreign_born, equity_index) %&gt;%
  #GT fmt_percent expects percents as decimals
  mutate(across(starts_with(&quot;perc&quot;), ~ ./100)) %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Table 3: Equity Indicators&quot;,
             subtitle = &quot;Components of the Equity Subindex&quot;) %&gt;%
  fmt_number(columns = vars(equity_index),
             n_sigfig = 2,
             suffixing = TRUE) %&gt;%
  fmt_percent(columns = vars(perc_person_of_color, perc_30hamfi, perc_public_assistance, perc_foreign_born),
              decimals = 0) %&gt;%
  cols_label(district = &quot;Metro District&quot;,
             perc_person_of_color = &quot;Person of Color&quot;, 
             perc_30hamfi = &quot;Extremely Low Income&quot;, 
             perc_public_assistance = &quot;Public Assistance&quot;, 
             perc_foreign_born = &quot;Foreign Born&quot;, 
             equity_index = &quot;Index&quot;) %&gt;%
  cols_move(columns = vars(perc_person_of_color, perc_30hamfi, perc_public_assistance, perc_foreign_born, equity_index),
            after = vars(district)) %&gt;%
  tab_spanner(
    label = &quot;Index&quot;,
    columns = vars(equity_index)
  ) %&gt;%
  tab_spanner(
    label = &quot;Percent&quot;,
    columns = vars(perc_person_of_color, perc_30hamfi, perc_public_assistance, perc_foreign_born, equity_index)
  ) %&gt;%
  cols_align(align = &quot;center&quot;) %&gt;%
  tab_source_note(
    source_note = md(&quot;Greater Louisville Project&quot;)
  ) %&gt;%
  tab_source_note(
    source_note = md(&quot;Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.&quot;)
  ) %&gt;%
  opt_row_striping(row_striping = TRUE) %&gt;%
  opt_table_outline() %&gt;%
  tab_options(
    table.font.size = px(12),
    table.width = pct(50)
  ) 

metro_equity_tbl</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#zsazselssx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 50%;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D3D3D3;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D3D3D3;
}

#zsazselssx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zsazselssx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zsazselssx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zsazselssx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zsazselssx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zsazselssx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zsazselssx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zsazselssx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zsazselssx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zsazselssx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zsazselssx .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#zsazselssx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zsazselssx .gt_from_md > :first-child {
  margin-top: 0;
}

#zsazselssx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zsazselssx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zsazselssx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#zsazselssx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zsazselssx .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#zsazselssx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zsazselssx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zsazselssx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zsazselssx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zsazselssx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zsazselssx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#zsazselssx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zsazselssx .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#zsazselssx .gt_left {
  text-align: left;
}

#zsazselssx .gt_center {
  text-align: center;
}

#zsazselssx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zsazselssx .gt_font_normal {
  font-weight: normal;
}

#zsazselssx .gt_font_bold {
  font-weight: bold;
}

#zsazselssx .gt_font_italic {
  font-style: italic;
}

#zsazselssx .gt_super {
  font-size: 65%;
}

#zsazselssx .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="zsazselssx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="6" class="gt_heading gt_title gt_font_normal" style>Table 3: Equity Indicators</th>
    </tr>
    <tr>
      <th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Components of the Equity Subindex</th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">Metro District</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="5">
        <span class="gt_column_spanner">Percent</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Person of Color</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Extremely Low Income</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Public Assistance</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Foreign Born</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Index</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">68&percnt;</td>
      <td class="gt_row gt_center">43&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">0.48</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">69&percnt;</td>
      <td class="gt_row gt_center gt_striped">28&percnt;</td>
      <td class="gt_row gt_center gt_striped">2&percnt;</td>
      <td class="gt_row gt_center gt_striped">18&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.67</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">66&percnt;</td>
      <td class="gt_row gt_center">45&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">4&percnt;</td>
      <td class="gt_row gt_center">0.57</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">60&percnt;</td>
      <td class="gt_row gt_center gt_striped">50&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.53</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">74&percnt;</td>
      <td class="gt_row gt_center">45&percnt;</td>
      <td class="gt_row gt_center">3&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">0.63</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">6</td>
      <td class="gt_row gt_center gt_striped">53&percnt;</td>
      <td class="gt_row gt_center gt_striped">46&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">0.38</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">16&percnt;</td>
      <td class="gt_row gt_center">11&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">7&percnt;</td>
      <td class="gt_row gt_center">&minus;0.71</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">8</td>
      <td class="gt_row gt_center gt_striped">7&percnt;</td>
      <td class="gt_row gt_center gt_striped">15&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.92</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">9</td>
      <td class="gt_row gt_center">15&percnt;</td>
      <td class="gt_row gt_center">19&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">&minus;0.67</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">10</td>
      <td class="gt_row gt_center gt_striped">28&percnt;</td>
      <td class="gt_row gt_center gt_striped">28&percnt;</td>
      <td class="gt_row gt_center gt_striped">2&percnt;</td>
      <td class="gt_row gt_center gt_striped">9&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.28</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">11</td>
      <td class="gt_row gt_center">23&percnt;</td>
      <td class="gt_row gt_center">11&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">&minus;0.53</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">12</td>
      <td class="gt_row gt_center gt_striped">27&percnt;</td>
      <td class="gt_row gt_center gt_striped">26&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.32</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">13</td>
      <td class="gt_row gt_center">31&percnt;</td>
      <td class="gt_row gt_center">23&percnt;</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">12&percnt;</td>
      <td class="gt_row gt_center">&minus;0.035</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">14</td>
      <td class="gt_row gt_center gt_striped">15&percnt;</td>
      <td class="gt_row gt_center gt_striped">28&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.51</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">15</td>
      <td class="gt_row gt_center">38&percnt;</td>
      <td class="gt_row gt_center">32&percnt;</td>
      <td class="gt_row gt_center">5&percnt;</td>
      <td class="gt_row gt_center">8&percnt;</td>
      <td class="gt_row gt_center">0.11</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">16</td>
      <td class="gt_row gt_center gt_striped">18&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">8&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.67</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">17</td>
      <td class="gt_row gt_center">25&percnt;</td>
      <td class="gt_row gt_center">15&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">10&percnt;</td>
      <td class="gt_row gt_center">&minus;0.43</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">18</td>
      <td class="gt_row gt_center gt_striped">20&percnt;</td>
      <td class="gt_row gt_center gt_striped">12&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">11&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.57</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">19</td>
      <td class="gt_row gt_center">17&percnt;</td>
      <td class="gt_row gt_center">14&percnt;</td>
      <td class="gt_row gt_center">1&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">&minus;0.71</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">20</td>
      <td class="gt_row gt_center gt_striped">16&percnt;</td>
      <td class="gt_row gt_center gt_striped">17&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.74</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">21</td>
      <td class="gt_row gt_center">44&percnt;</td>
      <td class="gt_row gt_center">29&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">19&percnt;</td>
      <td class="gt_row gt_center">0.28</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">22</td>
      <td class="gt_row gt_center gt_striped">22&percnt;</td>
      <td class="gt_row gt_center gt_striped">13&percnt;</td>
      <td class="gt_row gt_center gt_striped">1&percnt;</td>
      <td class="gt_row gt_center gt_striped">5&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.63</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">23</td>
      <td class="gt_row gt_center">23&percnt;</td>
      <td class="gt_row gt_center">16&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">&minus;0.54</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">24</td>
      <td class="gt_row gt_center gt_striped">31&percnt;</td>
      <td class="gt_row gt_center gt_striped">26&percnt;</td>
      <td class="gt_row gt_center gt_striped">3&percnt;</td>
      <td class="gt_row gt_center gt_striped">11&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.13</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">25</td>
      <td class="gt_row gt_center">24&percnt;</td>
      <td class="gt_row gt_center">20&percnt;</td>
      <td class="gt_row gt_center">2&percnt;</td>
      <td class="gt_row gt_center">6&percnt;</td>
      <td class="gt_row gt_center">&minus;0.49</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">26</td>
      <td class="gt_row gt_center gt_striped">26&percnt;</td>
      <td class="gt_row gt_center gt_striped">20&percnt;</td>
      <td class="gt_row gt_center gt_striped">4&percnt;</td>
      <td class="gt_row gt_center gt_striped">13&percnt;</td>
      <td class="gt_row gt_center gt_striped">&minus;0.19</td>
    </tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="6">Greater Louisville Project</td>
    </tr>
    <tr>
      <td class="gt_sourcenote" colspan="6">Metro Council Districts are estimated from tract level data. Data is from the Urban Institute.</td>
    </tr>
  </tfoot>
  
</table></div>
</div>
</div>
<div id="home-mortgages" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Home Mortgages</h1>
<div id="mortgages-by-geography" class="section level2">
<h2>Mortgages by geography</h2>
<p>In 2019, about 3.8 mortgages were issued per 100 residents; however, the availability of mortgages varies greatly across the city. Two census tracts saw 0 mortgages issued in 2019, and most of West Louisville saw fewer than 1 mortgage issued per 100 residents. Meanwhile, many areas experienced a much larger availability of mortgages, especially where there is new construction around the edges of the county.</p>
<pre class="r"><code>home_loan_tract_race &lt;- home_loan_tract %&gt;%
  filter(year == 2019, sex == &quot;total&quot;, race != &quot;total&quot;) %&gt;%
  select(tract, race, denial:rate_spread)

home_loan_tract %&lt;&gt;%
  filter(year == 2019, sex == &quot;total&quot;, race == &quot;total&quot;) %&gt;%
  select(tract, denial:rate_spread)

jfco_sf %&lt;&gt;% left_join(home_loan_tract, by = c(&quot;GEOID&quot; = &quot;tract&quot;))

loan_num_labs &lt;- c(&quot;No mortgages&quot;, &quot;Less than 1&quot;, &quot;1 to 3&quot;, &quot;3 to 5&quot;, &quot;5 to 10&quot;, &quot;More than 10&quot;)

jfco_sf %&lt;&gt;%
  mutate(
    loan_num_fill = 
      case_when(
        loan_number_per_100 == 0 ~ loan_num_labs[1],
        loan_number_per_100 &lt;= 1 ~ loan_num_labs[2],
        loan_number_per_100 &lt;= 3 ~ loan_num_labs[3],
        loan_number_per_100 &lt;= 5 ~ loan_num_labs[4],
        loan_number_per_100 &lt;= 10 ~ loan_num_labs[5],
        loan_number_per_100 &gt; 10 ~ loan_num_labs[6],
        is.na(loan_number_per_100) ~ NA_character_,
        TRUE ~ &quot;error!!&quot;) %&gt;%
      factor(levels = loan_num_labs, ordered = TRUE))

ggplot(jfco_sf) + 
  geom_sf(aes(fill = loan_num_fill)) +
  scale_fill_manual(values = viridis::viridis(6, direction = -1), na.value = &quot;grey&quot;) +
  theme_bw(base_size = 22, base_family = &quot;Montserrat&quot;) +
  theme(panel.grid = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.border = element_blank(),
        legend.title = element_blank()) +
  labs(title = &quot;Mortgages issued per 100 residents in 2019&quot;) +
  theme(
    panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
    plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
    legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
    legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
    legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))</code></pre>
<p><img src="index_files/figure-html/mortgages_per_person-1.png" width="672" /></p>
</div>
<div id="mortgages-by-race" class="section level2">
<h2>Mortgages by race</h2>
<p>We can also examine mortgage data by race. Black residents in Louisville received fewer than half the number of mortgages per person that White residents did in 2019.</p>
<pre class="r"><code># Interactive Mortgage map
# load(&quot;home_loans_detail.RData&quot;)
# home_loan_detail %&lt;&gt;%
#   select(tract, year, race, sex, loan_status, income, loan, rate) %&gt;%
#   mutate(tract = str_extract(tract, &quot;21111.*&quot;)) %&gt;%
#   filter(year == 2019, loan_status == &quot;approved&quot;)
# 
# num_points &lt;- home_loan_detail %&gt;%
#   group_by(tract) %&gt;%
#   summarise(n = n(), .groups=&quot;drop&quot;) %&gt;%
#   left_join(glptools::map_tract, by = &quot;tract&quot;) %&gt;%
#   group_by(tract) %&gt;%
#   nest() %&gt;%
#   mutate(points = map(data, function(x) st_sample(x$geometry, x$n))) %&gt;%
#   unnest()
# 
# home_loan_detail %&lt;&gt;% arrange(tract)
# num_points %&lt;&gt;% arrange(tract)
# 
# st_geometry(home_loan_detail) &lt;- num_points$points
# 
# library(leaflet)
# 
# 
# fillpal &lt;- colorFactor(RColorBrewer::brewer.pal(5, &quot;Dark2&quot;), domain = unique(home_loan_detail$race))
# 
# leaflet(filter(home_loan_detail, is.na(race))) %&gt;%
#   addCircleMarkers(
#     radius = ~sqrt(loan / 30000),
#     #radius = 5,
#     stroke=T,
#     fillColor = ~fillpal(race),
#     color = ~fillpal(race),
#     weight = 1,
#     fillOpacity = 0.15,
#     opacity = 0.4) %&gt;%
#   addLegend(pal = fillpal, values = unique(home_loan_detail$race)) %&gt;%
#   addTiles()


mortgage_county &lt;- home_loan_county

plt_by &lt;- function(df, group_var, var, title_text = &quot;Home Mortgages&quot;, 
                   y_axis = &quot;Percent&quot;, y_min = NA, units = &quot;number&quot;) {
  var &lt;- enquo(var)
  group_var &lt;- enquo(group_var)

  text_scale &lt;- 1
  
  plt &lt;- ggplot(data = df, aes(x = year, y = !!var, group = !!group_var, colour = !!group_var)) +
    geom_point(size = 2) +
    geom_line(size = .65) +
    theme_bw() +
    labs(title = title_text, x = &quot;Year&quot;, y = y_axis) +
    theme(legend.position = &quot;bottom&quot;)
  
  plt &lt;- plt  + 
    scale_colour_manual(values = c(&quot;#323844&quot;, &quot;#d63631&quot;)) +
    scale_x_continuous(breaks = seq(from = 2007, to = 2019, by = 2)) +
    theme(text = element_text(family = &quot;Montserrat&quot;),
          
          legend.title     = element_text(size = 30 * text_scale),
          legend.text      = element_text(size = 24 * text_scale,
                                          margin = margin(b = 0.2 * text_scale, t = 0.2 * text_scale, unit = &quot;cm&quot;)),

          axis.text    = element_text(size = 24 * text_scale),
          axis.title   = element_text(size = 30 * text_scale),
          axis.title.x = element_text(margin = margin(t = 0.3 * text_scale, unit = &quot;cm&quot;)),
          axis.title.y = element_text(margin = margin(r = 0.3 * text_scale, unit = &quot;cm&quot;)),
      
          plot.title = element_text(size = 42 * text_scale,
                                    hjust = .5,
                                    margin = margin(b = 0.4 * text_scale, unit = &quot;cm&quot;)))
  
  if (!is.na(y_min)) {
    plt &lt;- plt + ylim(y_min, NA)
  }
  
  if(units == &quot;Dollars&quot;) plt &lt;- plt + scale_y_continuous(labels = scales::dollar)
  if(units == &quot;Percent&quot;) plt &lt;- plt + scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1, scale = 1))

  plt &lt;- plt +
    theme(
      panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
      plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
      legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
      legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
      legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA)
  )
  
  plt
}

mortgage_county %&lt;&gt;% filter(FIPS == &quot;21111&quot;, sex==&quot;total&quot;, race %in% c(&quot;black&quot;, &quot;white&quot;)) %&gt;%
  rename(Race = race) %&gt;%
  mutate(Race = str_to_title(Race))

plt_by(mortgage_county, Race, loan_number_per_100, &quot;Mortgages by race&quot;, y_axis = &quot;Mortgages per 100 People&quot;, y_min = 0)</code></pre>
<p><img src="index_files/figure-html/mortgage_number_race-1.png" width="672" /></p>
</div>
<div id="mortgage-dollars-by-race" class="section level2">
<h2>Mortgage Dollars by race</h2>
<p>The racial disparity is mortgages is even larger when you incorporate the dollar amount of mortgages issues. In 2019, white residents received $2.60 in mortgages for every $1 that Black residents received after adjusting for population size.</p>
<pre class="r"><code>plt_by(mortgage_county, Race, loan_amount_pp, &quot;Mortgage Lending by race&quot;, y_axis = &quot;Dollars per 100 People&quot;, y_min = 0,
       units = &quot;Dollars&quot;)</code></pre>
<p><img src="index_files/figure-html/mortgage_dollars_race-1.png" width="672" /></p>
</div>
<div id="denial-rates-by-race" class="section level2">
<h2>Denial Rates by Race</h2>
<p>Black residents are denied mortgages at a rate roughly twice that of white residents. The mortgage denial rate for Black residents has decreased from a high of 29% in 2008 to a low of 14% in 2019. However, it has not shown signs of decreasing in recent years, and Black residents are more likely to be impacted by the economic impacts of COVID-19, worsening the disparity in 2020 and beyond.</p>
<pre class="r"><code>plt_by(mortgage_county, Race, denial, &quot;Mortgage Denial by race&quot;, y_axis = &quot;Denial Rate&quot;, y_min = 0, units= &quot;Percent&quot;)</code></pre>
<p><img src="index_files/figure-html/mortgage_denial_race-1.png" width="672" /></p>
</div>
<div id="denial-rates-by-geography" class="section level2">
<h2>Denial Rates by Geography</h2>
<p>A major factor in mortgage availability is denial rates. While some areas of town saw few to no mortgage denials, people in many parts of West Louisville experienced denial rates of 30 to 40%.</p>
<pre class="r"><code>make_map(denial, title = &quot;Mortgage Denial Rate in 2019&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Denial rate&quot;)</code></pre>
<p><img src="index_files/figure-html/mortgage_denial-1.png" width="672" /></p>
</div>
<div id="interest-rates-by-geography" class="section level2">
<h2>Interest Rates by geography</h2>
<p>For the mortgages that were issued, interest rates varied from around 3.5% to around 5%. While the average interest rate was around 4% for the much of East Louisville, average interest rates in West Louisville were closer to 5%. A 30-year mortgage with an interest rate of 5% requires monthly payments that are 13% higher than a mortgage with an interest rate of 4%.</p>
<pre class="r"><code>make_map(rate, title = &quot;Mortgage Interest Rate in 2019&quot;, 
         legend = &quot;Percent&quot;, 
         caption = &quot;Interest rate&quot;)</code></pre>
<p><img src="index_files/figure-html/mortgage_interest-1.png" width="672" /></p>
</div>
</div>
<div id="housing-price-changes" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="tabset tabset-fade tabset-pills">Housing Price Changes</h1>
<p>As Louisville grows, increasing home prices reflect changes in inflation and increasing demand for homes. Long-term growth in home prices helps homeowners build equity and wealth. Short-term appreciation can be a boon to homeowners with the finances to stay in their home, though it also causes many homeowners and renters to be dislocated from their neighborhood.</p>
<div id="long-term-appreciation" class="section level2">
<h2>Long-term appreciation</h2>
<p>This map shows the change in existing home prices across zip codes since 2000, controlling for new construction. Since 2000, existing homes in Louisville have increased in value by an average of 57% (an average of about 2.4% per year). However, not every area of the city has benefited equally from this growth. Home prices in zip code 40204, which contains the Upper Highlands and Germantown, have more than doubled since 2000. While many zip codes close to downtown also saw high growth, many parts of West Louisville saw slow growth, and homes in 40212 lost value.</p>
<pre class="r"><code>lou_num &lt;- HPI_county %&gt;% filter(FIPS == &quot;21111&quot;)

housing_price_index &lt;- HPI_zip

housing_price_index %&lt;&gt;% 
  filter(year == 2019)

map_zip %&lt;&gt;% left_join(housing_price_index, by = &quot;zip&quot;)

hpi_change &lt;- c(&quot;Lost value&quot;, &quot;0% - 25%&quot;, &quot;25% - 50%&quot;, &quot;50% - 75%&quot;, &quot;75% - 100%&quot;, &quot;100% - 125%&quot;)
hpi_2015_change &lt;- c(&quot;Lost value&quot;, &quot;0% - 10%&quot;, &quot;10% - 20%&quot;, &quot;20% - 30%&quot;, &quot;30% - 40%&quot;, &quot;40% - 50%&quot;)

map_zip %&lt;&gt;%
  mutate(
    hpi_fill = 
      case_when(
        HPI &lt; 100 ~ hpi_change[1],
        HPI &lt; 125 ~ hpi_change[2],
        HPI &lt; 150 ~ hpi_change[3],
        HPI &lt; 175 ~ hpi_change[4],
        HPI &lt; 200 ~ hpi_change[5],
        HPI &lt; 225 ~ hpi_change[6],
        is.na(HPI) ~ NA_character_,
        TRUE ~ &quot;error!!&quot;) %&gt;%
      factor(levels = hpi_change, ordered = TRUE),
    hpi_2015_fill = 
      case_when(
        HPI_2015 &lt; 0 ~ hpi_2015_change[1],
        HPI_2015 &lt; 10 ~ hpi_2015_change[2],
        HPI_2015 &lt; 20 ~ hpi_2015_change[3],
        HPI_2015 &lt; 30 ~ hpi_2015_change[4],
        HPI_2015 &lt; 40 ~ hpi_2015_change[5],
        HPI_2015 &lt; 50 ~ hpi_2015_change[6],
        is.na(HPI) ~ NA_character_,
        TRUE ~ &quot;error!!&quot;) %&gt;%
      factor(levels = hpi_2015_change, ordered = TRUE))

ggplot(map_zip) + 
  geom_sf(aes(fill = hpi_fill)) +
  scale_fill_manual(values = viridis::viridis(6, direction = -1), na.value = &quot;grey&quot;) +
  #scale_fill_viridis() +
  theme_bw(base_size = 22, base_family = &quot;Montserrat&quot;) +
  theme(panel.grid = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.border = element_blank(),
        legend.title = element_blank()) +
  labs(title = &quot;Change in housing prices since 2000&quot;) +
  theme(
    panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
    plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
    legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
    legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
    legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))</code></pre>
<p><img src="index_files/figure-html/long_term_appreciation-1.png" width="672" /></p>
</div>
<div id="short-term-appreciation" class="section level2">
<h2>Short-term appreciation</h2>
<p>Looking at the growth since 2015 highlights zip codes where changes in home prices have been very acute. The average home in Louisville increased in value by 21% between 2015 and 2019. The vast majority of zip codes saw total growth of 10% - 30%, while changes in home prices for zip codes in West Louisville range from a decrease of 30% in 40212 to an increase of 40% in 40203. The rapid price increase in 40203, which contains parts of Russell and Old Louisville, threaten to displace many residents. In 40203, home prices across Louisville increased by an average of 8.8% per year.</p>
<pre class="r"><code>ggplot(map_zip) + 
  geom_sf(aes(fill = hpi_2015_fill)) +
  scale_fill_manual(values = viridis::viridis(6, direction = -1), na.value = &quot;grey&quot;) +
  #scale_fill_viridis() +
  theme_bw(base_size = 22, base_family = &quot;Montserrat&quot;) +
  theme(panel.grid = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        panel.border = element_blank(),
        legend.title = element_blank()) +
  labs(title = &quot;Change in housing prices since 2015&quot;) +
  theme(
    panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
    plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
    legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
    legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
    legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))</code></pre>
<p><img src="index_files/figure-html/short_term_appreciation-1.png" width="672" /></p>
</div>
</div>
<div id="housing-availability" class="section level1">
<h1>Housing Availability</h1>
<p>Housing must be both affordable and available for families to have housing that meets their needs. Based on framework from the Housing Needs Assessment, we compare households’ incomes to the price of housing available to them.</p>
<p>We use the Area Median Income (AMI) to group households and housing units. In 2019, the AMI for Louisville was $76,400 for a family of four. (The AMI adjusts for household size.) We also use AMI to group homes and apartments by determining whether the housing would be affordable to households in that income group. Housing is affordable is a household spends less than 30% of their income on housing costs. For a fuller explanation of AMI, see the next section.</p>
<p>We find that households making less than 30% of AMI do not have enough housing units available to them. While 39,000 households have incomes below 30% of AMI, there are only enough affordable and available units for about half of them of them.</p>
<p>This creates an affordability gap for households making between 30% and 50% of AMI. While there are actually more housing units than households at this income level, many of them are occupied by households with lower incomes, making them unavailable. The same problem exists for households in the 80% AMI income group.</p>
<p>At higher income levels, we find that households generally have access to affordable housing.</p>
<p>Creating housing opportunities for households below 30% of AMI would help ease the housing gap not only for them, but for households in higher income groups as well.</p>
<pre class="r"><code>library(magrittr)

acs_micro_houses_ddi &lt;- ipumsr::read_ipums_ddi(&quot;usa_00083.xml&quot;)
acs_houses_unoccupied &lt;- ipumsr::read_ipums_micro(acs_micro_houses_ddi, verbose=F)

acs_houses_unoccupied %&lt;&gt;% clean_acs_micro()

acs_houses_unoccupied %&lt;&gt;% 
  filter(FIPS == &quot;21111&quot;,
         year %in% 2015:2019)

acs_micro &lt;- arrow::read_feather(&quot;../../glpdata/data-raw/microdata/acs_micro.feather&quot;)

# Create table of AMI limits based on HUD information
mult = c(0.7, 0.8, 0.9, 1 + seq(0, 0.64, by = 0.08))

mult_br = c(0.7, 0.75, 0.9, 1.04 + seq(0, 0.88, by = 0.12))

ami_table_16 &lt;- data.frame(
  hh_size = rep(1:12),
  ami30    = c(15050, 17200, 20780, 25100, 29420, 33740, 38060, 42380, 
               plyr::round_any(42380 + (42380 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami50    = c(25050, 28600, 32200, 35750, 38650, 41500, 44350, 47200, 
               plyr::round_any(47200 + (47200 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami80    = c(40050, 45800, 51500, 57200, 61800, 66400, 70950, 75550, 
               plyr::round_any(75550 + (75550 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami100   = 71500 * mult,
  ami150   = 71500 * mult * 1.5,
  ami200   = 71500 * mult * 2)

ami_table_16_house &lt;- ami_table_16 %&gt;%
  transmute(
    bedrooms = hh_size - 1,
    ami30_house = ami30,
    ami50_house = ami50,
    ami80_house = ami80,
    ami100_house = ami100,
    ami150_house = ami150, 
    ami200_house = ami200)

ami_table_19 &lt;- data.frame(
  hh_size = rep(1:12),
  ami30    = c(16050, 18350, 21330, 25750, 30170, 34590, 39010, 43430, 
               plyr::round_any(43430 + (43430 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami50    = c(26750, 30600, 34400, 38200, 41300, 44350, 47400, 50450,
               plyr::round_any(50450 + (50450 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami80    = c(42800, 48900, 55000, 61100, 66000, 70900, 75800, 80700, 
               plyr::round_any(75550 + (75550 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami100   = plyr::round_any(76400 * mult, 50, ceiling),
  ami150   = plyr::round_any(76400 * mult * 1.5, 50, ceiling),
  ami200   = plyr::round_any(76400 * mult * 2, 50, ceiling))

# Calculate household size, subset, and add AMI dataframe
acs_micro %&lt;&gt;%
  filter(
    FIPS == &quot;21111&quot;,
    year %in% 2015:2019,
    OWNERSHP != 0) %&gt;%
  group_by(year, SERIAL) %&gt;%
  mutate(hh_size = n()) %&gt;%
  ungroup() %&gt;%
  filter(PERNUM == 1)

# Calculate adjustment factor for renters who did not report utilty information
utility_adjust &lt;- acs_micro %&gt;%
  filter(
    #vacant |
    RENTGRS &gt; RENT) %&gt;%
  mutate(utility_est = (RENTGRS - RENT) / RENT) %&gt;%
  summarise(utiity_est = Hmisc::wtd.quantile(utility_est, HHWT, probs = 0.5, na.rm = T)) %&gt;%
  pull(utiity_est) %&gt;%
  unname()

# Process microdata
acs_micro %&lt;&gt;%
  mutate(
    
    # Recode missing values
    OWNCOST  = replace(OWNCOST, OWNCOST == 99999, NA),
    HHINCOME = replace(HHINCOME, HHINCOME == 99999, NA),
    OWNERSHP = replace(OWNERSHP, OWNERSHP == 0, NA),
    RENTGRS  = case_when(
      RENTGRS == 0 &amp; OWNERSHP == 1 ~ NA_real_,
      RENTGRS == RENT ~ RENT * (1 + utility_adjust),
      TRUE ~ RENTGRS),
    
    BEDROOMS = case_when(
      BEDROOMS == 0 ~ NA_real_,
      BEDROOMS &gt;= 1 ~ BEDROOMS -1),

    # calculate homeownership and cost burden
    homeownership = if_else(OWNERSHP == 1, 1, 0),
    hcost = if_else(homeownership == 1, OWNCOST, RENTGRS),
    cost_burden = if_else(hcost * 12 / HHINCOME &gt; 0.3, 1, 0),
    severe_cost_burden = if_else(hcost * 12 / HHINCOME &gt; 0.5, 1, 0),

    hh_type = case_when(
      homeownership == 1 &amp; cost_burden == 0 ~ &quot;noncb_homeowner&quot;,
      homeownership == 1 &amp; cost_burden == 1 ~ &quot;cb_homeowner&quot;,
      homeownership == 0 &amp; cost_burden == 0 ~ &quot;noncb_renter&quot;,
      homeownership == 0 &amp; cost_burden == 1 ~ &quot;cb_renter&quot;,
      TRUE ~ NA_character_))  %&gt;%
  # Adjust HHICOME for inflation
  COLA(HHINCOME, base_year = 2019, rpp = F) %&gt;%
  left_join(ami_table_19, by = &quot;hh_size&quot;) %&gt;%
  mutate(
    hh_ami_group = case_when(
      HHINCOME &lt; ami30  ~ 30,
      HHINCOME &lt; ami50  ~ 50,
      HHINCOME &lt; ami80  ~ 80,
      HHINCOME &lt; ami100 ~ 100,
      HHINCOME &lt; ami150 ~ 150,
      HHINCOME &lt; ami200 ~ 200,
      TRUE ~ Inf))
  
  
# Tidy data for unoccupied houses
acs_houses_unoccupied %&lt;&gt;%
  mutate(
    vacancy = case_when(
      VACANCY == 0 ~ &quot;occupied&quot;,
      VACANCY %in% 1:2 ~ &quot;available&quot;,
      VACANCY %in% 3:9 ~ &quot;unavailable&quot;)) %&gt;%
  filter(vacancy %in% c(&quot;available&quot;)) %&gt;%
  transmute(
    FIPS, year, HHWT,
    homeownership = if_else(VACANCY == 2, 1, 0),
    RENTGRS = RENT * (1 + utility_adjust),
    RENT,
    VALUEH,
    BEDROOMS = case_when(
      BEDROOMS == 0 ~ NA_real_,
      BEDROOMS &gt;= 1 ~ BEDROOMS -1),
    VACANCY)

# Bind data to occupied houses
acs_houses &lt;- acs_micro %&gt;%
  bind_rows(acs_houses_unoccupied) %&gt;%
  
  # Adjust for inflation
  COLA(RENTGRS, VALUEH, base_year = 2019, rpp = F) %&gt;%
  mutate(
    
    # Reverse cost-burden calc to test AMI category of home
    # Per HNA, mortgage of $279,307 corresponds to a rent ceiling of $1,787
    est_cost = case_when(
      homeownership == 0 ~ RENTGRS * 12,
      homeownership == 1 ~ VALUEH / 279307 * 1787 * 12),
    
    min_income = est_cost / 0.3,
    
    br_pp    = min_income * mult[BEDROOMS + 1],
    br_p1.5p = min_income * mult_br[BEDROOMS + 1],
    ami_pct = br_p1.5p / 71500 * 100,
    
    adj_income = HHINCOME * mult[hh_size]) %&gt;%
  mutate(
    # house_ami_group = case_when(
    #   br_p1.5p &lt; (71500 * 0.3)  ~ 30,
    #   br_p1.5p &lt; (71500 * 0.5)  ~ 50,
    #   br_p1.5p &lt; (71500 * 0.8)  ~ 80,
    #   br_p1.5p &lt; (71500 * 1) ~ 100,
    #   br_p1.5p &lt; (71500 * 1.5) ~ 150,
    #   br_p1.5p &lt; (71500 * 2) ~ 200,
    #   TRUE ~ Inf)) %&gt;%
    house_ami_group = case_when(
      br_p1.5p &lt; (76400 * 0.3)  ~ 30,
      br_p1.5p &lt; (76400 * 0.5)  ~ 50,
      br_p1.5p &lt; (76400 * 0.8)  ~ 80,
      br_p1.5p &lt; (76400 * 1) ~ 100,
      br_p1.5p &lt; (76400 * 1.5) ~ 150,
      br_p1.5p &lt; (76400 * 2) ~ 200,
      TRUE ~ Inf)) %&gt;%
  mutate(
    hh_ami_group = replace_na(hh_ami_group, 0),
    available = if_else(VACANCY %in% 1:2 | adj_income &gt;= br_p1.5p, 1, 0)) %&gt;%
    #available = if_else(VACANCY %in% 1:2 | hh_ami_group &lt;= house_ami_group, 1, 0)) %&gt;%
  select(year, HHWT, RENT, RENTGRS, VALUEH, VACANCY, OWNERSHP, BEDROOMS, hh_size, homeownership, 
         hh_ami_group, est_cost, min_income, br_pp, br_p1.5p, ami_pct, house_ami_group, available)

results_people &lt;- acs_micro %&gt;%
  group_by(homeownership, hh_ami_group) %&gt;%
  summarise(households = sum(HHWT) / 5, .groups = &quot;drop&quot;) %&gt;%
  rename(ami_group = hh_ami_group)

sum_avail &lt;- function(df, value) {
  filter(df, hh_ami_group &lt;= value, house_ami_group &lt;= value) %&gt;%
    group_by(homeownership) %&gt;%
    summarise(
      ami_group = value,
      houses = sum(HHWT) / 5, .groups=&quot;drop&quot;)
}

results_30 &lt;- sum_avail(acs_houses, 30)
results_50 &lt;- sum_avail(acs_houses, 50)
results_80 &lt;- sum_avail(acs_houses, 80)
results_100 &lt;- sum_avail(acs_houses, 100)
results_150 &lt;- sum_avail(acs_houses, 150)
results_200 &lt;- sum_avail(acs_houses, 200)
results_Inf &lt;- sum_avail(acs_houses, Inf)

results_houses &lt;- bind_rows(results_30, results_50, results_80, results_100, results_150, results_200, results_Inf)

# actual &lt;- data.frame(
#   homeownership = c(rep(0:1, each = 7)),
#   level = rep(c(30, 50, 80, 100, 150, 200, Inf), 2),
#   report_num = c(17563, 46023, 89538, 98513, 115443, 121556, NA_real_, 8404, 19788, 54031, 75898, 120394, 148999, NA_real_))

# results_houses %&lt;&gt;%
#   left_join(actual) %&gt;%
#   mutate(dif = (freq - report_num) / report_num * 100)

results &lt;- full_join(results_people, results_houses)

library(ggtext)

results %&lt;&gt;%
  group_by(ami_group) %&gt;%
  summarise(across(households:houses, sum), .groups = &quot;drop&quot;)

group_avail &lt;- function(df, value) {
  df %&gt;%
    filter(ami_group &lt;= value) %&gt;%
    mutate(ami = value)
}

results$houses[2:7] = results$houses[2:7] - results$houses[1:6]

results %&lt;&gt;%
  mutate(
    households_cumsum = cumsum(households),
    homes_cumsum = cumsum(houses),
    lab_color = viridis(7, direction = -1)[2:7][match(ami_group, c(30, 50, 80, 100, 150, 200))],
    label = paste0(&quot;&lt;span style=&#39;font-size:36pt&#39;&gt;&quot;, 
                   scales::percent(homes_cumsum / households_cumsum, accuracy = 1), &quot;&lt;/span&gt;&quot;,
                   &quot;&lt;span style=&#39;font-size:12pt&#39;&gt;&lt;br&gt;of households&lt;br&gt;up to&lt;br&gt;&lt;/span&gt;&quot;,
                   &quot;&lt;span style=&#39;font-size:20pt; face:bold; color:&quot;, lab_color, &quot;&#39;&gt;&quot;, 
                   ami_group, &quot;% AMI&quot;, &quot;&lt;/span&gt;&quot;))

results_30 &lt;- group_avail(results, 30)
results_50 &lt;- group_avail(results, 50)
results_80 &lt;- group_avail(results, 80)
results_100 &lt;- group_avail(results, 100)
results_150 &lt;- group_avail(results, 150)
results_200 &lt;- group_avail(results, 200)

results_graph &lt;- bind_rows(results_30, results_50, results_80, results_100, results_150, results_200)

results_graph %&lt;&gt;%
  pivot_longer(households:houses, names_to = &quot;obs_type&quot;, values_to = &quot;value&quot;) %&gt;%
  mutate(
    ami_group = factor(ami_group, 
                       levels = c(200, 150, 100, 80, 50, 30),
                       labels = c(200, 150, 100, 80, 50, 30),
                       ordered = T),
    ami = factor(ami, labels = unique(label))) %&gt;% 
  arrange(ami_group)


ggplot(results_graph, aes(x = obs_type, y = value, fill = ami_group)) + 
  geom_col(position = &#39;stack&#39;) + 
  scale_fill_manual(values = viridis(7, direction = -1)[2:7],
                    breaks = rev(c(200, 150, 100, 80, 50, 30)),  
                    guide = guide_legend(reverse = TRUE),
                    name = &quot;AMI Group&quot;) +
  facet_grid(~ ami) + 
  theme_bw(base_family = &quot;Montserrat&quot;, base_size = 22) +
  theme(
    panel.grid = element_blank(),
    panel.spacing.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_markdown(margin=margin(-20)),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    panel.border = element_blank(),
    strip.background = element_blank(),
    plot.subtitle = element_text(hjust = 0, lineheight = 0.5),
    legend.title = element_text(size = 24),
    strip.text.x = element_markdown(lineheight = 0.6),
    strip.placement = &quot;outside&quot;,
    plot.title = element_text(size = 32),
    plot.caption = element_text(size = 16, lineheight = 0.5, hjust = 0)) + 
  scale_y_continuous(expand = c(.15, 0)) +
  geom_text(
    aes(label = scales::number(stat(y), scale = .001, accuracy = 1, suffix = &quot;K&quot;), group = ami), 
    stat = &#39;summary&#39;, fun = sum, vjust = -1, size = 6, family = &quot;Montserrat&quot;) +
  labs(title = &quot;Affordability Gaps&quot;,
       subtitle = &quot;There are enough available and affordable homes for...&quot;,
       caption = &quot;Within each group, the bar on the left represents the number of households at that income level\nand the bar on the right represents the number of homes that are available and affordable to them.&quot;) +
  scale_x_discrete(
    name = NULL,
    labels = c(households = &quot;&lt;img src=&#39;001-family.png&#39; width=&#39;16&#39;/&gt;&quot;,
           houses = &quot;&lt;img src=&#39;002-house-black-silhouette-without-door.png&#39; width=&#39;16&#39;/&gt;&quot;)) +
  theme(
    panel.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the panel
    plot.background = element_rect(fill = &quot;transparent&quot;, color = NA), # bg of the plot
    legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend bg
    legend.box.background = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;), # get rid of legend panel bg
    legend.key = element_rect(fill = &quot;transparent&quot;,colour = NA))</code></pre>
<p>The table below shows the cutoffs for family income, monthly rent, and home purchase prices for each AMI group.</p>
<p>We group residents by percentages of the Area Median Income (AMI) as determined by the Department of Housing and Urban Development. In 2019, the AMI for a four-person household in Louisville was $76,300. Median income means 50% of four-person families earned less than the AMI, and 50% earned more. The AMI is adjusted down for smaller households and up for larger households. For example, the AMI for a person living alone is $54,000, and the AMI for a six-person household is $89,000.</p>
<p>Households in the 30% AMI income group have income less than or equal to the Federal Poverty Level (about 30% of $76,300). Households in the 50% AMI group have income between the Federal Poverty Level and 50% of the AMI. Households in the 80% AMI income group have income between 50% of the AMI and 80% of the AMI, and so on for higher AMI levels.</p>
<p>We group homes and apartments by AMI by determining the minimum income needed for a household to live there affordably (without spending more than 30% of their income on housing costs). We adjust housing costs by bedroom size to align with how the AMI for households is adjusted by household size.</p>
<p>We determine the AMI group of apartments using monthly rent and utilities. We determine the AMI group of homes based on the value of the home in order to measure the affordability of homeownership for new buyers, rather than cost-burden for existing homeowners. Based on the conversion used in the Housing Needs Assessment, we calculate that the annual cost of homeownership is about 1/13th of the home’s value.</p>
<p>More details on the methodology can be found in the Housing Needs Assessment and the Housing Needs Assessment Methodology: <a href="https://loutrustfund.org/wp-content/uploads/2019/02/HNA_Appendix_190130.pdf" class="uri">https://loutrustfund.org/wp-content/uploads/2019/02/HNA_Appendix_190130.pdf</a> <a href="https://secureservercdn.net/166.62.110.60/7nm.5c8.myftpupload.com/wp-content/uploads/2019/02/HNA_FINAL_190222.pdf" class="uri">https://secureservercdn.net/166.62.110.60/7nm.5c8.myftpupload.com/wp-content/uploads/2019/02/HNA_FINAL_190222.pdf</a></p>
<pre class="r"><code>ami_table_19 &lt;- data.frame(
  hh_size = rep(1:12),
  ami30    = c(16050, 18350, 21330, 25750, 30170, 34590, 39010, 43430, 
               plyr::round_any(43430 + (43430 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami50    = c(26750, 30600, 34400, 38200, 41300, 44350, 47400, 50450,
               plyr::round_any(50450 + (50450 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami80    = c(42800, 48900, 55000, 61100, 66000, 70900, 75800, 80700, 
               plyr::round_any(75550 + (75550 / 1.32 * 0.08) * 1:4, 50, ceiling)),
  ami100   = plyr::round_any(76400 * mult, 50, ceiling),
  ami150   = plyr::round_any(76400 * mult * 1.5, 50, ceiling),
  ami200   = plyr::round_any(76400 * mult * 2, 50, ceiling))

ami_table_19 %&lt;&gt;%
  pivot_longer(ami30:ami200, names_to = &quot;ami&quot;, values_to = &quot;value&quot;) %&gt;%
  mutate(
    rent = value * 0.3 / 12,
    mortgage = rent / 1787 * 279307) %&gt;% 
  pivot_wider(names_from = ami, values_from = value:mortgage)

library(gt)

ami_19 &lt;- ami_table_19 %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Area Median Incomes, Rents, and Purchase Price Limits by Household Size&quot;) %&gt;%
  fmt_currency(columns = vars(value_ami30, value_ami50, value_ami80, value_ami100,
                            value_ami150, value_ami200,
                            mortgage_ami30, mortgage_ami50, mortgage_ami80, mortgage_ami100,
                            mortgage_ami150, mortgage_ami200),
              decimals = 0,
              suffixing =T) %&gt;%
  fmt_currency(columns = vars(rent_ami30, rent_ami50, rent_ami80, rent_ami100,
                              rent_ami150, rent_ami200),
            decimals = 1,
            suffixing =T) %&gt;%
  cols_label(
    hh_size = &quot;Household Size&quot;,
    value_ami30 = &quot;Annual Income&quot;, 
    value_ami50 = &quot;Annual Income&quot;, 
    value_ami80 = &quot;Annual Income&quot;,
    value_ami100 = &quot;Annual Income&quot;,
    value_ami150 = &quot;Annual Income&quot;, 
    value_ami200 = &quot;Annual Income&quot;,
    rent_ami30 = &quot;Monthly Rent Ceiling&quot;, 
    rent_ami50 = &quot;Monthly Rent Ceiling&quot;,
    rent_ami80 = &quot;Monthly Rent Ceiling&quot;,
    rent_ami100 = &quot;Monthly Rent Ceiling&quot;,
    rent_ami150 = &quot;Monthly Rent Ceiling&quot;, 
    rent_ami200 = &quot;Monthly Rent Ceiling&quot;,
    mortgage_ami30 = &quot;Purchase Price Ceiling&quot;, 
    mortgage_ami50 = &quot;Purchase Price Ceiling&quot;, 
    mortgage_ami80 = &quot;Purchase Price Ceiling&quot;, 
    mortgage_ami100 = &quot;Purchase Price Ceiling&quot;,
    mortgage_ami150 = &quot;Purchase Price Ceiling&quot;,
    mortgage_ami200 = &quot;Purchase Price Ceiling&quot;) %&gt;%
  # cols_move(columns = vars(perc_cost_burdened_under_35k, perc_renters, perc_poverty_12mnth, perc_unemployed_laborforce, perc_overcrowding_renter_1.50_or_more, housing_instability_index),
  #           after = vars(district)) %&gt;%
  tab_spanner(
    label = &quot;30% AMI&quot;,
    columns = vars(value_ami30, rent_ami30, mortgage_ami30)
  ) %&gt;%
  tab_spanner(
    label = &quot;50% AMI&quot;,
    columns = vars(value_ami50, rent_ami50, mortgage_ami50)
  ) %&gt;%
  tab_spanner(
    label = &quot;80% AMI&quot;,
    columns = vars(value_ami80, rent_ami80, mortgage_ami80)
  ) %&gt;%
  tab_spanner(
    label = &quot;100% AMI&quot;,
    columns = vars(value_ami100, rent_ami100, mortgage_ami100)
  ) %&gt;%
  tab_spanner(
    label = &quot;150% AMI&quot;,
    columns = vars(value_ami150, rent_ami150, mortgage_ami150)
  ) %&gt;%
  tab_spanner(
    label = &quot;200% AMI&quot;,
    columns = vars(value_ami200, rent_ami200, mortgage_ami200)
  ) %&gt;%
  cols_align(align = &quot;center&quot;) %&gt;%
    tab_source_note(
    source_note = md(&quot;Greater Louisville Project&quot;)
  ) %&gt;%
  tab_source_note(
    source_note = md(&quot;Analysis framework from the 2019 Housing Needs Assessment.&quot;)
  ) %&gt;%
  opt_row_striping(row_striping = TRUE) %&gt;%
  opt_table_outline() %&gt;%
  tab_options(
    table.font.size = px(12),
    table.width = pct(50)
  ) 

ami_19</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
